var require = meteorInstall({"folder":{"funcs.ls.js":function(require){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// folder/funcs.ls.js                                                                                                  //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// Generated by LiveScript 1.5.0
var slice$ = [].slice;
this._ = lodash;
this.coll = {};
this.schema = {};
this.afState = {};
this.ors = function(it){
  return it.find(function(it){
    return it;
  });
};
this.ands = function(it){
  if (_.every(it)) {
    return _.last(it);
  }
};
this.bool = function(it){
  return !!it;
};
this.reduce = function(){
  var params, res$, i$, to$;
  res$ = [];
  for (i$ = 0, to$ = arguments.length; i$ < to$; ++i$) {
    res$.push(arguments[i$]);
  }
  params = res$;
  if (params.length === 2) {
    return Object.values(params[0]).reduce(params[1]);
  } else if (params.length === 3) {
    return Object.values(params[1]).reduce(params[2], params[0]);
  } else {
    return 'your arguments are invalid';
  }
};
this.same = function(it){
  return bool(reduce(it, function(res, inc){
    if (res === inc) {
      return inc;
    }
  }));
};
this.reverse = function(it){
  return reduce([], it, function(res, inc){
    return [inc].concat(slice$.call(res));
  });
};
if (Meteor.isClient) {
  this.m = require('mithril');
  this.normalize = function(obj){
    var recurse, key, val;
    recurse = function(value, name){
      var isNum, res, ref$;
      if (_.isObject(value)) {
        isNum = _.size(_.filter(value, function(val, key){
          return +key;
        }));
        res = (ref$ = {}, ref$[name + ""] = isNum > 0
          ? _.map(value, recurse)
          : value.getMonth
            ? value
            : _.merge.apply(_, [{}].concat(slice$.call(_.map(value, recurse)))), ref$);
        if (+name) {
          return res[name];
        } else {
          return res;
        }
      } else {
        if (+name + 1) {
          return value;
        } else {
          return ref$ = {}, ref$[name + ""] = value, ref$;
        }
      }
    };
    obj = recurse(obj, 'obj').obj;
    for (key in obj) {
      val = obj[key];
      if (key.split('.').length > 1) {
        delete obj[key];
      }
    }
    return obj;
  };
  this.autoForm = function(opts){
    var state, scope, that, usedSchema, theSchema, omitFields, usedFields, arr, optionList, ref$, key$, stateTempGet, clonedDoc, usedDoc, normed, attr, columnize, inputTypes;
    state = afState;
    scope = (that = opts.scope) ? new SimpleSchema(function(){
      var reducer;
      reducer = function(res, val, key){
        var ref$;
        if (new RegExp("^" + that).test(key)) {
          return _.merge(res, (ref$ = {}, ref$[key + ""] = val, ref$));
        } else {
          return res;
        }
      };
      return _.reduce(opts.schema._schema, reducer, {});
    }()) : void 8;
    usedSchema = scope || opts.schema;
    theSchema = function(name){
      return usedSchema._schema[name];
    };
    omitFields = opts.omitFields ? _.pull.apply(_, [_.values(usedSchema._firstLevelSchemaKeys)].concat(slice$.call(opts.omitFields))) : void 8;
    usedFields = ors(arr = [omitFields, opts.fields, usedSchema._firstLevelSchemaKeys]);
    optionList = function(name){
      var arr, ref$, ref1$, ref2$, ref3$, ref4$, ref5$, ref6$, ref7$;
      return ors(arr = [
        (ref$ = theSchema(normed(name))) != null ? (ref1$ = ref$.allowedValues) != null ? ref1$.map(function(i){
          return {
            value: i,
            label: _.startCase(i)
          };
        }) : void 8 : void 8, _.isFunction((ref2$ = theSchema(normed(name))) != null ? (ref3$ = ref2$.autoform) != null ? ref3$.options : void 8 : void 8)
          ? (ref4$ = theSchema(normed(name))) != null ? (ref5$ = ref4$.autoform) != null ? ref5$.options(name) : void 8 : void 8
          : (ref6$ = theSchema(normed(name))) != null ? (ref7$ = ref6$.autoform) != null ? ref7$.options : void 8 : void 8, ['true', 'false'].map(function(i){
          return {
            value: JSON.parse(i),
            label: _.startCase(i)
          };
        })
      ]);
    };
    state.arrLen == null && (state.arrLen = {});
    state.form == null && (state.form = {});
    state.temp == null && (state.temp = {});
    state.errors == null && (state.errors = {});
    (ref$ = state.form)[key$ = opts.id] == null && (ref$[key$] = {});
    (ref$ = state.temp)[key$ = opts.id] == null && (ref$[key$] = []);
    stateTempGet = function(field){
      if (state.temp[opts.id]) {
        return _.findLast(state.temp[opts.id], function(it){
          return it.name === field;
        });
      }
    };
    if (that = opts.scope) {
      clonedDoc = _.assign({}, opts.doc, (ref$ = {}, ref$[that + ""] = [], ref$));
    }
    usedDoc = clonedDoc || opts.doc;
    normed = function(it){
      return it.replace(/\d/g, '$');
    };
    attr = {
      form: {
        id: opts.id,
        onchange: function(arg$){
          var target, that, arr, ref$, ref1$;
          target = arg$.target;
          if (that = opts.onchange) {
            that(target);
          }
          arr = ['radio', 'checkbox', 'select'];
          if (!in$((ref$ = theSchema(target.name)) != null ? (ref1$ = ref$.autoform) != null ? ref1$.type : void 8 : void 8, arr)) {
            state.form[opts.id][target.name] = target.value;
          }
          return opts.autosave && $("form#" + opts.id).submit();
        },
        onsubmit: function(e){
          var temp, formValues, obj, context, after, formTypes, that, ref$;
          e.preventDefault();
          temp = state.temp[opts.id].map(function(it){
            var ref$;
            return ref$ = {}, ref$[it.name + ""] = it.value, ref$;
          });
          formValues = _.filter(e.target, function(i){
            var a, arr, b;
            a = function(){
              return i.value !== 'on' && i.name;
            };
            arr = ['radio', 'checkbox', 'select'];
            b = function(){
              var ref$, ref1$;
              return in$((ref$ = theSchema(i)) != null ? (ref1$ = ref$.autoform) != null ? ref1$.type : void 8 : void 8, arr);
            };
            return a() && !b();
          }).map(function(arg$){
            var name, value;
            name = arg$.name, value = arg$.value;
            if (name && value) {
              return _.reduceRight(name.split('.'), function(res, inc){
                var ref$;
                return ref$ = {}, ref$[inc + ""] = res, ref$;
              }, value ? (function(){
                switch (theSchema(normed(name)).type) {
                case String:
                  return value;
                case Number:
                  return +value;
                case Date:
                  return new Date(value);
                }
              }()) : void 8);
            }
          });
          obj = normalize(_.merge.apply(_, temp.concat(formValues)));
          context = usedSchema.newContext();
          context.validate(_.merge({}, obj, !opts.scope ? opts.doc || {} : void 8));
          state.errors[opts.id] = _.merge.apply(_, [{}].concat(slice$.call(function(){
            var a;
            a = context._invalidKeys.filter(function(i){
              var arr, ref$;
              return ands(arr = [i.type !== 'keyNotInSchema', !((ref$ = theSchema(normed(i.name))) != null && ref$.autoValue)]);
            });
            return a.map(function(it){
              var ref$;
              return ref$ = {}, ref$[it.name + ""] = it.type, ref$;
            });
          }())));
          after = function(err, res){
            var ref$;
            if (res) {
              return (ref$ = opts.hooks) != null ? ref$.after(res) : void 8;
            }
          };
          formTypes = function(doc){
            return {
              insert: function(){
                return opts.collection.insert(doc || obj, after);
              },
              update: function(){
                return opts.collection.update({
                  _id: usedDoc._id
                }, {
                  $set: doc || obj
                }, after);
              },
              method: function(){
                return Meteor.call(opts.meteormethod, doc || obj, after);
              },
              'update-pushArray': function(){
                var ref$;
                return opts.collection.update({
                  _id: usedDoc._id
                }, {
                  $push: (ref$ = {}, ref$[opts.scope + ""] = {
                    $each: _.values(obj[opts.scope])
                  }, ref$)
                }, function(err, res){
                  var ref$;
                  if (res) {
                    return (ref$ = opts.hooks) != null ? ref$.after(doc) : void 8;
                  }
                });
              }
            };
          };
          if (_.values(state.errors[opts.id]).length === 0) {
            if (that = (ref$ = opts.hooks) != null ? ref$.before : void 8) {
              return that(obj, function(moded){
                return formTypes(moded)[opts.type]();
              });
            } else {
              return formTypes()[opts.type]();
            }
          }
        }
      },
      radio: function(name, value){
        var ref$;
        return {
          type: 'radio',
          name: name,
          id: name + "" + value,
          checked: value === (((ref$ = stateTempGet(name)) != null ? ref$.value : void 8) || (usedDoc != null ? usedDoc[name] : void 8)),
          onchange: function(){
            return state.temp[opts.id].push({
              name: name,
              value: value
            });
          }
        };
      },
      select: function(name){
        var ref$;
        return {
          name: name,
          value: ((ref$ = stateTempGet(name)) != null ? ref$.value : void 8) || (usedDoc != null ? usedDoc[name] : void 8),
          onchange: function(arg$){
            var target;
            target = arg$.target;
            return state.temp[opts.id].push({
              name: name,
              value: target.value
            });
          }
        };
      },
      checkbox: function(name, value){
        var that;
        return {
          type: 'checkbox',
          name: name,
          id: name + "" + value,
          data: value,
          onchange: function(){
            return state.temp[opts.id].push({
              name: name,
              value: _.map($("input:checked[name='" + name + "']"), function(it){
                var theVal;
                theVal = function(it){
                  var that;
                  if (that = +it) {
                    return that;
                  } else {
                    return it;
                  }
                };
                return theVal(it.attributes.data.nodeValue);
              })
            });
          },
          checked: (that = stateTempGet(name))
            ? in$(value.toString(), _.map(that.value, function(it){
              return it.toString();
            }))
            : usedDoc != null && usedDoc[name + ".0"] ? in$(value.toString(), _.compact(_.map(usedDoc, function(val, key){
              if (_.includes(key, name)) {
                return val.toString();
              }
            }))) : void 8
        };
      },
      arrLen: function(name, type){
        return {
          onclick: function(){
            var ref$, num;
            (ref$ = state.arrLen)[name] == null && (ref$[name] = 0);
            num = {
              inc: 1,
              dec: -1
            };
            return state.arrLen[name] += num[type];
          }
        };
      }
    };
    columnize = function(it){
      var chunk, recDom, structure;
      chunk = function(it){
        return reduce([], it, function(res, inc){
          var end, ref$, i$, first, last;
          end = function(){
            return slice$.call(res).concat([[inc]]);
          };
          if ((ref$ = inc.type) === Object || ref$ === Array) {
            return end();
          } else {
            first = 0 < (i$ = res.length - 1) ? slice$.call(res, 0, i$) : (i$ = 0, []), last = res[i$];
            if (!((last != null ? last.length : void 8) < opts.columns)) {
              return end();
            } else {
              if ((ref$ = last[0].type) === Object || ref$ === Array) {
                return end();
              } else {
                return slice$.call(first).concat([slice$.call(last).concat([inc])]);
              }
            }
          }
        });
      };
      recDom = function(i){
        if (_.isArray(i)) {
          return i.map(function(it){
            return recDom(it);
          });
        } else {
          return function(){
            var type, ref$, split, title;
            type = (i != null ? (ref$ = i.autoform) != null ? ref$.type : void 8 : void 8) || 'other';
            split = _.split(i.name, '.');
            title = function(){
              if (split.length === 1) {
                return i.head;
              } else {
                return i.head + "." + _.last(split);
              }
            };
            return inputTypes(title(), i)[type]();
          }();
        }
      };
      structure = function(it){
        return it.map(function(i){
          return m('.columns', i.map(function(j){
            var ref$;
            return m('div', {
              'class': ((ref$ = j.attrs) != null ? ref$.type : void 8) !== 'hidden' ? 'column' : void 8
            }, j);
          }));
        });
      };
      return structure(recDom(chunk(it)));
    };
    inputTypes = function(name, schema){
      var title, arr, ref$, label, error;
      title = ors(arr = [(ref$ = theSchema(normed(name))) != null ? ref$.label : void 8, _.startCase(_.last(_.split(normed(name), '.')))]);
      label = m('label.label', m('span', title), !theSchema(normed(name)).optional ? m('span.has-text-danger', '*') : void 8);
      error = _.startCase(_.find(state.errors[opts.id], function(val, key){
        return key === name;
      }));
      return {
        hidden: function(){
          return m('input', {
            type: 'hidden',
            name: name,
            id: name,
            value: typeof schema.autoValue == 'function' ? schema.autoValue(name, _.map(state.form[opts.id], function(val, key){
              return {
                value: val,
                name: key
              };
            })) : void 8
          });
        },
        textarea: function(){
          return m('div', label, m('textarea.textarea', {
            name: name,
            id: name,
            'class': error ? 'is-danger' : void 8,
            value: state.form[opts.id][name] || (usedDoc != null ? usedDoc[name] : void 8)
          }), error ? m('p.help.is-danger', error) : void 8);
        },
        range: function(){
          var ref$;
          return m('div', label, m('input', {
            type: 'range',
            id: name,
            name: name,
            'class': error ? 'is-danger' : void 8,
            value: state.form[opts.id][name] || (usedDoc != null ? (ref$ = usedDoc[name]) != null ? ref$.toString() : void 8 : void 8)
          }), error ? m('p.help.is-danger', error) : void 8);
        },
        checkbox: function(){
          return m('div', label, optionList(name).map(function(j){
            return m('label.checkbox', m('input', attr.checkbox(name, j.value)), m('span', _.startCase(j.label)));
          }), error ? m('p.help.is-danger', error) : void 8);
        },
        select: function(){
          var arr, ref$;
          return m('div', label, m('.select', m('select', attr.select(name), m('option', {
            value: ''
          }, ors(arr = [(ref$ = theSchema(normed(name)).autoform) != null ? ref$.firstLabel : void 8, 'Select One'])), optionList(name).map(function(j){
            return m('option', {
              value: j.value
            }, j.label);
          }))), error ? m('p.help.is-danger', error) : void 8);
        },
        radio: function(){
          return m('.control', label, optionList(normed(name)).map(function(j){
            return m('label.radio', m('input', attr.radio(name, j.value)), m('span', _.startCase(j.label)));
          }), error ? m('p.help.is-danger', error) : void 8);
        },
        other: function(){
          var defaultInputTypes, defaultType, maped, ref$, ref1$, that, ref2$, ref3$, sorted, filtered, found, docLen, this$ = this;
          defaultInputTypes = {
            text: String,
            number: Number,
            radio: Boolean,
            date: Date
          };
          defaultType = function(){
            return _.toPairs(defaultInputTypes).find(function(it){
              return it[1] === schema.type;
            });
          };
          maped = _.map(usedSchema._schema, function(val, key){
            return _.merge(val, {
              name: key
            });
          });
          if ((ref$ = schema.autoform) != null && ref$.options) {
            return inputTypes(name, defaultType()[0]).select();
          } else if (((ref1$ = defaultType()) != null ? ref1$[0] : void 8) === 'radio') {
            return inputTypes(name, defaultType()[0]).radio();
          } else if (that = (ref2$ = defaultType()) != null ? ref2$[0] : void 8) {
            return m('.field', label, m('.control', m('input.input', {
              'class': error ? 'is-danger' : void 8,
              type: ((ref3$ = schema.autoform) != null ? ref3$.type : void 8) || that,
              name: name,
              id: name,
              step: 'any',
              value: function(){
                var date, ref$;
                date = (usedDoc != null ? usedDoc[name] : void 8) && that === 'date' && moment(usedDoc[name]).format('YYYY-MM-DD');
                return ((ref$ = state.form[opts.id]) != null ? ref$[name] : void 8) || date || (usedDoc != null ? usedDoc[name] : void 8);
              }()
            })), error ? m('p.help.is-danger', error) : void 8);
          } else if (schema.type === Object) {
            sorted = function(){
              return reduce([], reverse(maped), function(res, inc){
                var ref$;
                if (((ref$ = inc.autoform) != null ? ref$.type : void 8) === 'hidden') {
                  return slice$.call(res).concat([inc]);
                } else {
                  return [inc].concat(slice$.call(res));
                }
              });
            };
            filtered = sorted().filter(function(j){
              var getLen, conds;
              getLen = function(str){
                return _.size(_.split(str, '.'));
              };
              return _.every(conds = [_.includes(j.name, normed(name) + "."), getLen(name) + 1 === getLen(j.name)]);
            });
            return m('.box', !+label ? m('h5', label) : void 8, m('.box', columnize(filtered.map(function(it){
              return _.merge(it, {
                head: name
              });
            }))));
          } else if (schema.type === Array) {
            found = maped.find(function(it){
              return it.name === normed(name) + ".$";
            });
            docLen = opts.scope === name
              ? 1
              : function(it){
                return it.length - 1;
              }(_.filter(usedDoc, function(val, key){
                return _.includes(key, name + ".");
              }));
            return m('.box', opts.scope !== name ? m('div', m('h5.subtitle', label), m('a.button.is-success', attr.arrLen(name, 'inc'), '+ Add'), m('a.button.is-warning', attr.arrLen(name, 'dec'), '- Rem')) : void 8, (function(){
              var i$, to$, results$ = [];
              for (i$ = 1, to$ = state.arrLen[name] || docLen || 0; i$ <= to$; ++i$) {
                results$.push(i$);
              }
              return results$;
            }()).map(function(num){
              var type, ref$;
              type = (typeof j != 'undefined' && j !== null ? (ref$ = j.autoform) != null ? ref$.type : void 8 : void 8) || 'other';
              return inputTypes(name + "." + num, found)[type]();
            }), error ? m('p.help.is-danger', error) : void 8);
          }
        }
      };
    };
    return {
      view: function(){
        var ref$, ref1$;
        return m('.box', m('form', attr.form, m('.row', columnize(usedFields.map(function(i){
          return _.merge(theSchema(i), {
            name: i,
            head: i
          });
        }))), m('.row', m('.columns', m('.column.is-1', m('input.button.is-primary', {
          type: 'submit',
          value: opts != null ? opts.buttonContent : void 8,
          'class': opts != null ? opts.buttonClasses : void 8
        })), m('.column.is-1', m('input.button.is-warning', {
          type: 'reset',
          value: opts != null ? (ref$ = opts.reset) != null ? ref$.content : void 8 : void 8,
          'class': opts != null ? (ref1$ = opts.reset) != null ? ref1$.classes : void 8 : void 8
        }))))));
      }
    };
  };
}
function in$(x, xs){
  var i = -1, l = xs.length >>> 0;
  while (++i < l) if (x === xs[i]) return true;
  return false;
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"modules.ls.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// folder/modules.ls.js                                                                                                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// Generated by LiveScript 1.5.0
this.modules = [
  {
    name: 'regis',
    full: 'Pendaftaran',
    icon: 'people',
    color: 'orange'
  }, {
    name: 'bayar',
    full: 'Pembayaran',
    icon: 'monetization_on',
    color: 'green'
  }, {
    name: 'jalan',
    full: 'Rawat Jalan',
    icon: 'directions',
    color: 'blue'
  }, {
    name: 'inap',
    full: 'Rawat Inap',
    icon: 'directions',
    color: 'red'
  }, {
    name: 'obat',
    full: 'Apotek',
    icon: 'enhanced_encryption',
    color: 'light-green'
  }, {
    name: 'farmasi',
    full: 'Gudang Farmasi',
    icon: 'local_pharmacy',
    color: 'orange'
  }, {
    name: 'manajemen',
    full: 'Manajemen',
    icon: 'people',
    color: 'orange'
  }, {
    name: 'amprah',
    full: 'Amprah',
    icon: 'rv_hookup',
    color: 'blue-grey'
  }
];
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"parent.ls.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// folder/parent.ls.js                                                                                                 //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// Generated by LiveScript 1.5.0
this.look = function(list, val){
  return selects[list].find(function(it){
    return it.value === val;
  });
};
this.look2 = function(list, id){
  return coll[list].find().fetch().find(function(it){
    return it._id === id;
  });
};
this.randomId = function(){
  return Math.random().toString(36).slice(2);
};
this.zeros = function(it){
  return repeatString$('0', 6 - it.toString().length) + it;
};
this.min = function(it){
  return reduce(it, function(res, inc){
    if (inc < res) {
      return inc;
    } else {
      return res;
    }
  });
};
this.max = function(it){
  return reduce(it, function(res, inc){
    if (inc > res) {
      return inc;
    } else {
      return res;
    }
  });
};
this.abs = function(it){
  return Math.sqrt(Math.pow(it, 2));
};
this.dayDiff = function(date){
  var diff;
  diff = date.getTime() - new Date().getTime();
  diff /= 1000 * 60 * 60 * 24;
  return Math.round(diff);
};
this.hari = function(it){
  return moment(it).format('D MMM YYYY');
};
this.rupiah = function(it){
  return "Rp " + numeral(+it || 0).format('0,0');
};
if (Meteor.isClient) {
  this.state = {
    pagins: {
      limit: 5,
      page: 0
    }
  };
  this.currentRoute = function(){
    return m.route.get().split('/')[1];
  };
  this.isDr = function(){
    var ref$, ref1$;
    return (ref$ = _.split((ref1$ = Meteor.user()) != null ? ref1$.username : void 8, '.')[0]) === 'dr' || ref$ === 'drg';
  };
  this.roles = function(){
    var ref$;
    return (ref$ = Meteor.user()) != null ? ref$.roles : void 8;
  };
  this.tds = function(it){
    return it.map(function(i){
      return m('td', i);
    });
  };
  this.userRole = function(it){
    var that, ref$, ref1$, this$ = this;
    if (that = it) {
      return ((ref$ = roles()) != null ? (ref1$ = ref$[currentRoute()]) != null ? ref1$[0] : void 8 : void 8) === that;
    } else {
      return function(it){
        return it[0][0];
      }(_.values(roles()));
    }
  };
  this.userGroup = function(it){
    var that, ref$, this$ = this;
    if (that = it) {
      return (ref$ = roles()) != null ? ref$[that] : void 8;
    } else {
      return function(it){
        return it[0];
      }(_.keys(roles()));
    }
  };
  this.pagins = function(it){
    var position;
    position = state.pagins.page * state.pagins.limit;
    return _.slice(it, position, position + state.pagins.limit);
  };
  this.elem = {
    modal: function(obj){
      var that;
      return m('.modal.is-active', m('.modal-background'), m('.modal-card', m('header.modal-card-head', m('p.modal-card-title', obj.title), m('button.delete', {
        'aria-label': 'close',
        onclick: function(){
          return state.modal = null;
        }
      })), (that = obj.content) ? m('section.modal-card-body', m('.content', that)) : void 8, m('footer.modal-card-foot', (that = obj.confirm) ? m('button.button.is-success', {
        onclick: function(){
          return typeof obj.action == 'function' ? obj.action() : void 8;
        }
      }, m('span', that)) : void 8, (that = obj.danger) ? m('button.button.is-danger', {
        onclick: function(){
          return typeof obj.dangerAction == 'function' ? obj.dangerAction() : void 8;
        }
      }, that) : void 8)));
    },
    pagins: function(arr){
      return m('nav.pagination', {
        role: 'navigation',
        'aria-label': 'pagination'
      }, [['previous', -1], ['next', 1]].map(function(i){
        return m(".pagination-" + i[0], {
          onclick: function(){
            return state.pagins.page += i[1];
          }
        }, m('span', _.startCase(i[0])));
      }), m('.pagination-list', [0, 1, 2].map(function(i){
        return m('a.pagination-link', m('span', _.startCase(state.pagins.page + i + 1)));
      })));
    },
    report: function(arg$){
      var title, action;
      title = arg$.title, action = arg$.action;
      return m('.box', m('h5', title), m('form.columns', {
        onsubmit: function(e){
          var arr;
          return arr = [
            e.preventDefault(), action({
              start: new Date(e.target[0].value),
              end: new Date(e.target[1].value),
              type: e.target[2].value
            })
          ];
        }
      }, m('.column', m('input.input', {
        type: 'date',
        placeholder: 'Mulai'
      })), m('.column', m('input.input', {
        type: 'date',
        placeholder: 'Akhir'
      })), m('.column.is-2', m('.field', m('.control', m('.select', m('select', ['Tabel', 'Pdf'].map(function(i){
        return m('option', i);
      })))))), m('.column.is-1', m('input.button.is-info', {
        type: 'submit',
        value: 'Unduh'
      }))));
    }
  };
  this.csv = function(title, docs){
    var content, blob;
    content = exportcsv.exportToCSV(docs, true, ';');
    blob = new Blob([content], {
      type: 'text/plain;charset=utf-8'
    });
    return saveAs(blob, title + ".csv");
  };
}
function repeatString$(str, n){
  for (var r = ''; n > 0; (n >>= 1) && (str += str)) if (n & 1) r += str;
  return r;
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"pdf.ls.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// folder/pdf.ls.js                                                                                                    //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// Generated by LiveScript 1.5.0
var kop, slice$ = [].slice;
if (Meteor.isClient) {
  kop = {
    text: 'PEMERINTAH PROVINSI RIAU\nRUMAH SAKIT UMUM DAERAH PETALA BUMI\nJL. Dr. Soetomo No. 65, Telp. (0761) 23024\n\n\n',
    alignment: 'center',
    bold: true
  };
  this.makePdf = {
    card: function(idpasien){
      var doc, pdf;
      doc = coll.pasien.findOne(idpasien);
      pdf = pdfMake.createPdf({
        content: ["Nama : " + doc.regis.nama_lengkap, "No. MR: " + zeros(doc.no_mr)],
        pageSize: 'B8',
        pageMargins: [110, 50, 0, 0],
        pageOrientation: 'landscape'
      });
      return pdf.download(zeros(doc.no_mr) + "_card.pdf");
    },
    consent: function(){
      var doc, pdf, arr;
      doc = coll.pasien.findOne();
      pdf = pdfMake.createPdf({
        content: arr = [
          kop, {
            text: '\nDATA UMUM PASIEN',
            alignment: 'center'
          }, {
            columns: [
              ['NO. MR', 'NAMA LENGKAP', 'TEMPAT & TANGGAL LAHIR', 'GOLONGAN DARAH', 'JENIS KELAMIN', 'AGAMA', 'PENDIDIKAN', 'PEKERJAAN', 'NAMA AYAH', 'NAMA IBU', 'NAMA SUAMI / ISTRI', 'ALAMAT', 'NO. TELP / HP'], [zeros(doc.no_mr), doc.regis.nama_lengkap, (doc.regis.tmpt_lahir || '-') + ", " + moment(doc.regis.tgl_lahir).format('D/MM/YYYY')].concat(
                slice$.call(_.map(['darah', 'kelamin', 'agama', 'pendidikan', 'pekerjaan'], function(i){
                  var ref$;
                  return ((ref$ = look(i, doc.regis[i])) != null ? ref$.label : void 8) || '-';
                })), slice$.call(_.map(['ayah', 'ibu', 'pasangan', 'alamat', 'kontak'], function(i){
                  return doc.regis[i] || '-';
                }))
              ).map(function(it){
                return ": " + it;
              })
            ]
          }, {
            text: '\nPERSETUJUAN UMUM (GENERAL CONSENT)',
            alignment: 'center'
          }, {
            table: {
              body: [[
                'S', 'TS', {
                  text: 'Keterangan',
                  alignment: 'center'
                }
              ]].concat(slice$.call([['Saya akan mentaati peraturan yang berlaku di RSUD Petala Bumi'], ['Saya memberi kuasa kepada dokter dan semua tenaga kesehatan untuk melakukan pemeriksaan / pengobatan / tindakan yang diperlakukan upaya kesembuhan saya / pasien tersebut diatas'], ['Saya memberi kuasa kepada dokter dan semua tenaga kesehatan yang ikut merawat saya untuk memberikan keterangan medis saya kepada yang bertanggung jawab atas biaya perawatan saya.'], ['Saya memberi kuasa kepada RSUD Petala Bumi untuk menginformasikan identitas sosial saya kepada keluarga / rekan / masyarakat'], ['Saya mengatakan bahwa informasi hasil pemeriksaan / rekam medis saya dapat digunakan untuk pendidikan / penelitian demi kemajuan ilmu kesehatan']].map(function(it){
                return [' ', ' '].concat(slice$.call(it));
              })))
            }
          }, '\nPetunjuk :', 'S: Setuju', 'TS: Tidak Setuju', {
            alignment: 'justify',
            columns: [
              {
                text: '\n\n\n\n__________________\n' + _.startCase(Meteor.user().username),
                alignment: 'center'
              }, {
                text: 'Pekanbaru, ' + moment().format('DD/MM/YYYY') + '\n\n\n\n__________________\n' + _.startCase(doc.regis.nama_lengkap),
                alignment: 'center'
              }
            ]
          }
        ]
      });
      return pdf.download(zeros(doc.no_mr) + "_consent.pdf");
    },
    payRawat: function(idpasien, idrawat, rows){
      var pasien, rawat, items, table, pdf, arr, ref$, ref1$;
      pasien = coll.pasien.findOne(idpasien);
      rawat = pasien.rawat.find(function(it){
        return it.idrawat === idrawat;
      });
      items = rows.map(function(it){
        return [it[0], rupiah(it[1])];
      });
      table = {
        table: {
          widths: ['*', 'auto'],
          body: [['Uraian', 'Harga']].concat(slice$.call(items))
        }
      };
      pdf = pdfMake.createPdf({
        content: arr = [
          kop, "\n", {
            columns: [
              ['NO. MR', 'NAMA PASIEN', 'JENIS KELAMIN', 'TANGGAL LAHIR', 'UMUR', 'KLINIK'], [zeros(pasien.no_mr), _.startCase(pasien.regis.nama_lengkap), ((ref$ = look('kelamin', pasien.regis.kelamin)) != null ? ref$.label : void 8) || '-', moment().format('D/MM/YYYY'), moment().diff(pasien.regis.tgl_lahir, 'years') + " tahun", ((ref1$ = look('klinik', rawat.klinik)) != null ? ref1$.label : void 8) || '-'].map(function(it){
                return ": " + it;
              })
            ]
          }, {
            text: '\n\nRINCIAN PEMBAYARAN',
            alignment: 'center'
          }, table, "\nTOTAL BIAYA " + rupiah(_.sum(rows.map(function(it){
            return it[1];
          }))), {
            text: '\nPEKANBARU, ' + moment().format('D/MM/YYYY') + '\n\n\n\n\n' + _.startCase(Meteor.user().username),
            alignment: 'right'
          }
        ]
      });
      return pdf.download(zeros(pasien.no_mr) + "_payRawat.pdf");
    },
    payRegCard: function(idpasien, idrawat, rows){
      var doc, pdf, arr;
      doc = coll.pasien.findOne(idpasien);
      pdf = pdfMake.createPdf({
        content: arr = [
          kop, {
            columns: [
              ['TANGGAL', 'NO. MR', 'NAMA PASIEN', 'TARIF', '\n\nPETUGAS'], [moment().format('DD/MM/YYYY'), zeros(doc.no_mr), _.startCase(doc.regis.nama_lengkap)].concat(
                slice$.call(rows.map(function(it){
                  return it[0] + " " + rupiah(it[1]);
                })), [
                  "Total: " + rupiah(_.sum(rows.map(function(it){
                    return it[1];
                  }))), "\n\n " + _.startCase(Meteor.user().username)
                ]
              ).map(function(it){
                return ": " + it;
              })
            ]
          }
        ]
      });
      return pdf.download(zeros(doc.no_mr) + "_payRegCard.pdf");
    },
    rekap: function(){
      var fields, source, rows, headers;
      fields = ['no_mr_nama_pasien', 'nama_obat', 'nobatch', 'jumlah'];
      source = coll.rekap.find().fetch().map(function(i){
        return i.obat.map(function(j){
          return j.batches.map(function(k){
            var arr;
            return arr = [
              {
                text: "" + coll.pasien.findOne(i.idpasien).no_mr.toString() + "\n" + coll.pasien.findOne(i.idpasien).regis.nama_lengkap + "",
                rowSpan: _.sum(i.obat.map(function(it){
                  return it.batches.length;
                }))
              }, {
                text: look2('gudang', j.nama_obat).nama,
                rowSpan: j.batches.length
              }, k.nobatch, k.jumlah.toString()
            ];
          });
        });
      });
      rows = _.flattenDepth(source, 2);
      headers = [fields.map(function(it){
        return _.startCase(it);
      })];
      if (rows.length > 0) {
        Meteor.call('doneRekap');
        return pdfMake.createPdf({
          content: [{
            table: {
              body: slice$.call(headers).concat(slice$.call(rows))
            }
          }]
        }).download('cetak_rekap.pdf');
      }
    },
    icdx: function(pasien){
      var headers, rows, columns, arr;
      headers = ['tanggal', 'klinik', 'dokter', 'diagnosa', 'terapi', 'perawat', 'icd10'];
      rows = pasien.rawat.map(function(i){
        var arr;
        return arr = [
          hari(i.tanggal), look('klinik', i.klinik).label, Meteor.users.findOne(i.petugas.dokter).username, {
            ol: i.diagnosa
          }, {
            ul: i.tindakan.map(function(j){
              return _.startCase(look2('tarif', j.nama).nama);
            })
          }, Meteor.users.findOne(i.petugas.perawat).username, {
            ol: i.icdx
          }
        ];
      });
      columns = [['NO. MR', 'NAMA LENGKAP', 'TANGGAL LAHIR', 'JENIS KELAMIN'], arr = [pasien.no_mr.toString(), pasien.regis.nama_lengkap, hari(pasien.regis.tgl_lahir), look('kelamin', pasien.regis.kelamin).label]];
      return pdfMake.createPdf({
        content: arr = [
          kop, {
            text: 'FORM RESUME RAWAT JALAN',
            alignment: 'center'
          }, '\n\n', {
            columns: columns
          }, '\n\n', {
            table: {
              body: [headers.map(function(it){
                return _.startCase(it);
              })].concat(slice$.call(rows))
            }
          }
        ]
      }).download("icdX_" + pasien.no_mr + ".pdf");
    },
    csv: function(name, docs){
      var rows, headers, arr;
      rows = docs.map(function(it){
        return _.map(it, function(it){
          return it.toString();
        });
      });
      headers = [_.map(docs[0], function(val, key){
        return {
          text: key,
          bold: true,
          alignment: 'center'
        };
      })];
      if (rows.length > 0) {
        return pdfMake.createPdf({
          pageOrientation: 'landscape',
          content: arr = [
            kop, {
              table: {
                widths: (function(){
                  var i$, to$, results$ = [];
                  for (i$ = 0, to$ = headers[0].length; i$ < to$; ++i$) {
                    results$.push(i$);
                  }
                  return results$;
                }()).map(function(){
                  return 'auto';
                }),
                body: slice$.call(headers).concat(slice$.call(rows))
              }
            }
          ]
        }).download(name + ".pdf");
      }
    },
    visits: function(docs){
      var headers, rows, range, title, arr;
      headers = _.merge.apply(_, ['poli', 'bayar', 'status'].map(function(i){
        var ref$;
        return ref$ = {}, ref$[i + ""] = _.keys(docs[0][i]), ref$;
      }));
      rows = _.merge.apply(_, ['poli', 'bayar', 'status'].map(function(i){
        var ref$;
        return ref$ = {}, ref$[i + ""] = docs.map(function(j){
          return [j.hari].concat(_.values(j[i]).map(function(it){
            return it.toString();
          }));
        }), ref$;
      }));
      range = ['first', 'last'].map(function(i){
        var this$ = this;
        return function(it){
          return it.hari;
        }(_[i](docs));
      });
      title = "Laporan Kunjungan " + range[0] + " - " + range[1] + ".pdf";
      return pdfMake.createPdf({
        pageOrientation: 'landscape',
        content: arr = [
          kop, {
            text: title + " \n\n",
            alignment: 'center',
            bold: true
          }
        ].concat(slice$.call(['poli', 'bayar', 'status'].map(function(i){
          var x;
          return {
            table: {
              body: x = [['Tanggal'].concat(slice$.call(headers[i]))].concat(slice$.call(rows[i]))
            }
          };
        })))
      }).download(title);
    }
  };
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"rights.ls.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// folder/rights.ls.js                                                                                                 //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// Generated by LiveScript 1.5.0
var slice$ = [].slice;
if (Meteor.isClient) {
  this.rights = [
    {
      group: 'regis',
      list: ['regis']
    }, {
      group: 'bayar',
      list: ['bayar']
    }, {
      group: 'jalan',
      list: ['jalan', 'farmasi', 'amprah']
    }, {
      group: 'inap',
      list: ['inap', 'farmasi', 'amprah']
    }, {
      group: 'labor',
      list: ['labor']
    }, {
      group: 'radio',
      list: ['radio']
    }, {
      group: 'obat',
      list: ['obat', 'farmasi', 'amprah']
    }, {
      group: 'rekam',
      list: ['rekam', 'regis']
    }, {
      group: 'admisi',
      list: ['admisi']
    }, {
      group: 'manajemen',
      list: ['manajemen']
    }, {
      group: 'farmasi',
      list: ['farmasi', 'amprah']
    }
  ];
  _.map(rights, function(i){
    return _.assign(i, {
      list: slice$.call(i.list).concat(['panduan'])
    });
  });
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"selects.ls.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// folder/selects.ls.js                                                                                                //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// Generated by LiveScript 1.5.0
this.selects = {
  rawat: ['rawat_jalan', 'rawat_inap', 'igd'],
  pekerjaan: ['pns', 'swasta', 'wiraswasta', 'tni', 'polri', 'pensiunan', 'lainnya'],
  kelamin: ['laki_laki', 'perempuan'],
  agama: ['islam', 'katolik', 'protestan', 'buddha', 'hindu', 'kong_hu_chu'],
  pendidikan: ['sd', 'smp', 'sma', 'diploma', 's1', 's2', 's3', 'tidak_sekolah'],
  darah: ['a', 'b', 'ab', 'o'],
  cara_bayar: ['umum', 'bpjs', 'jamkesda_pekanbaru', 'jamkesda_kampar', 'lapas_dinsos', 'jampersal'],
  nikah: ['nikah', 'belum_nikah', 'janda', 'duda'],
  klinik: ['penyakit_dalam', 'gigi', 'kebidanan', 'tht', 'anak', 'saraf', 'mata', 'bedah', 'paru', 'kulit', 'fisioterapi', 'gizi', 'psikologi', 'tindakan', 'aps_labor', 'aps_radio'],
  karcis: [50, 30, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 50, 0, 0],
  bentuk: ['butir', 'kapsul', 'tablet', 'sendok_makan', 'sendok_teh'],
  tipe_dokter: ['umum', 'spesialis'],
  rujukan: ['datang_sendiri', 'rs_lain', 'puskesmas', 'faskes_lainnya'],
  keluar: ['pulang', 'rujuk'],
  barang: ['generik', 'non_generik', 'obat_narkotika', 'bhp', 'obat_keras_tertentu'],
  satuan: ['botol', 'vial', 'ampul', 'pcs', 'sachet', 'tube', 'supp', 'tablet', 'minidose', 'pot', 'turbuhaler', 'kaplet', 'kapsul', 'bag', 'pen', 'rectal', 'flash', 'cream', 'nebu', 'galon', 'lembar', 'roll', 'liter', 'cup', 'pasang', 'bungkus'],
  anggaran: ['blud', 'apbd'],
  alias: ['tn', 'ny', 'nn', 'an', 'by'],
  tinggal: ['orang_tua', 'keluarga', 'sendiri', 'panti_asuhan'],
  cara_masuk: ['jalan', 'kursi_roda', 'lainnya'],
  imunisasi: ['dpt1', 'dpt2', 'dpt3', 'bcg', 'campak', 'polio1', 'polio2', 'polio3', 'hepatitis', 'mmr'],
  penyakit: ['asma', 'diabetes', 'hipertensi', 'cancer', 'anemia', 'jantung', 'lainnya'],
  kb: ['iud', 'susuk', 'suntik', 'pil', 'steril', 'vasectomi'],
  frekuensi: ['sering', 'kadang', 'jarang'],
  nyeri: ['terbakar', 'tertindih', 'menyebar', 'tajam', 'tumpul', 'berdenyut', 'lainnya'],
  psikologi: ['tenang', 'marah', 'cemas', 'gelisah', 'takut', 'lainnya'],
  bab: ['asma', 'diare', 'konstipasi', 'colostomy'],
  bak: ['normal', 'retensia', 'inkontinesia', 'poliuria', 'disuria', 'lainnya'],
  bicara: ['normal', 'gangguan_bicara', 'lainnya'],
  hambatan: ['tidak_ada', 'pendengaran', 'cemas', 'motivasi_memburuk', 'bahasa', 'lainnya'],
  potensial: ['proses_penyakit', 'pengobatan', 'nutrisi', 'tindakan', 'lainnya'],
  returnable: ['bisa', 'tidak']
};
_.map(selects, function(i, j){
  return selects[j] = _.map(selects[j], function(m, n){
    return {
      value: n + 1,
      label: _.startCase(m)
    };
  });
});
selects.tindakan = function(){
  var ref$;
  if (Meteor.isClient) {
    return (ref$ = coll.tarif) != null ? ref$.find().fetch().map(function(it){
      return {
        value: it._id,
        label: it.nama
      };
    }) : void 8;
  }
};
selects.grupTindakan = function(){
  var a, ref$;
  if (Meteor.isClient) {
    a = (ref$ = coll.tarif) != null ? ref$.find().fetch().filter(function(it){
      var arr, this$ = this;
      return ands(arr = [
        it.first === 'jalan', it.second === _.snakeCase(function(it){
          return it.label;
        }(selects.klinik.find(function(it){
          var this$ = this;
          return it.value === function(it){
            return it.klinik;
          }(coll.pasien.findOne().rawat.find(function(it){
            return it.idrawat === state.docRawat;
          }));
        })))
      ]);
    }) : void 8;
    return _.uniqBy(a, 'third').map(function(it){
      return {
        value: it.third,
        label: _.startCase(it.third)
      };
    });
  }
};
selects.namaTindakan = function(name){
  var current, a, ref$;
  if (Meteor.isClient) {
    current = _.initial(name.split('.')).join('.') + ".grup";
    a = (ref$ = coll.tarif) != null ? ref$.find().fetch().filter(function(it){
      var arr, this$ = this;
      return ands(arr = [
        it.first === 'jalan', it.second === _.snakeCase(function(it){
          return it.label;
        }(selects.klinik.find(function(it){
          var this$ = this;
          return it.value === function(it){
            return it.klinik;
          }(coll.pasien.findOne().rawat.find(function(it){
            return it.idrawat === state.docRawat;
          }));
        }))), it.third === afState.form.formNurse[current]
      ]);
    }) : void 8;
    return a.map(function(it){
      return {
        value: it._id,
        label: _.startCase(it.nama)
      };
    });
  }
};
selects.gudang = function(){
  if (Meteor.isClient) {
    return coll.gudang.find().fetch().map(function(i){
      return {
        value: i._id,
        label: i.nama
      };
    });
  }
};
selects.obat = function(){
  var joined, a;
  if (Meteor.isClient) {
    joined = function(it){
      return _.join(it, ' ');
    };
    a = _.compact(coll.gudang.find().fetch().map(function(i){
      var ref$, arr;
      if ((ref$ = i.jenis) === 1 || ref$ === 2 || ref$ === 3) {
        return {
          value: i._id,
          label: joined(arr = [
            i.nama, "A" + _.sum(i.batch.map(function(it){
              return it.diapotik;
            })), "G" + _.sum(i.batch.map(function(it){
              return it.digudang;
            }))
          ])
        };
      }
    }));
    return _.sortBy(a, 'label');
  }
};
selects.bhp = function(){
  if (Meteor.isClient) {
    return _.compact(coll.gudang.find().fetch().map(function(i){
      if (i.jenis === 4) {
        return {
          value: i._id,
          label: i.nama
        };
      }
    }));
  }
};
selects.dokter = function(){
  var selPoli, a;
  if (Meteor.isClient) {
    selPoli = afState.form.formJalan['rawat.1.klinik'] - 1;
    a = Meteor.users.find().fetch().filter(function(i){
      var arr, ref$, this$ = this;
      return ands(arr = [
        (ref$ = _.split(i.username, '.')[0]) === 'dr' || ref$ === 'drg', _.includes((ref$ = i.roles) != null ? ref$.jalan : void 8, function(it){
          return it[selPoli];
        }(selects.klinik.map(function(it){
          return _.snakeCase(it.label);
        })))
      ]);
    });
    return a.map(function(it){
      return {
        value: it._id,
        label: _.startCase(it.username)
      };
    });
  }
};
selects.provinsi = function(){
  if (Meteor.isClient) {
    return coll.daerah.find().fetch().filter(function(it){
      return it.provinsi && !it.kabupaten;
    }).map(function(it){
      return {
        value: it.provinsi,
        label: _.startCase(it.daerah)
      };
    });
  }
};
selects.kabupaten = function(){
  if (Meteor.isClient) {
    return coll.daerah.find().fetch().filter(function(it){
      return it.kabupaten && it.provinsi;
    }).map(function(it){
      return {
        value: it.kabupaten,
        label: _.startCase(it.daerah)
      };
    });
  }
};
selects.kecamatan = function(){
  if (Meteor.isClient) {
    return coll.daerah.find().fetch().filter(function(it){
      return it.kecamatan && it.kabupaten;
    }).map(function(it){
      return {
        value: it.kecamatan,
        label: _.startCase(it.daerah)
      };
    });
  }
};
selects.kelurahan = function(){
  if (Meteor.isClient) {
    return coll.daerah.find().fetch().filter(function(it){
      return it.kelurahan && it.kecamatan;
    }).map(function(it){
      return {
        value: it.kelurahan,
        label: _.startCase(it.daerah)
      };
    });
  }
};
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}},"both.ls.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// both.ls.js                                                                                                          //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// Generated by LiveScript 1.5.0
['pasien', 'gudang', 'tarif', 'rekap', 'amprah', 'daerah'].map(function(i){
  coll[i] = new Meteor.Collection(i);
  coll[i].allow(_.merge.apply(_, ['insert', 'update', 'remove'].map(function(it){
    var ref$;
    return ref$ = {}, ref$[it + ""] = function(){
      return true;
    }, ref$;
  })));
  if (Meteor.isClient) {
    return ['added', 'changed'].map(function(j){
      var ref$;
      return coll[i].find().observe((ref$ = {}, ref$[j + ""] = function(){
        return m.redraw();
      }, ref$));
    });
  }
});
if (Meteor.isClient) {
  schema.regis = {
    no_mr: {
      type: Number,
      min: 100000,
      max: 999999
    },
    regis: {
      type: Object
    },
    'regis.alias': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.alias
      }
    },
    'regis.nama_lengkap': {
      type: String
    },
    'regis.no_ktp': {
      type: Number,
      max: 9999999999999999,
      optional: true
    },
    'regis.tgl_lahir': {
      type: Date
    },
    'regis.tmpt_lahir': {
      type: String,
      optional: true
    },
    'regis.kelamin': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.kelamin
      }
    },
    'regis.agama': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.agama
      }
    },
    'regis.nikah': {
      type: Number,
      optional: true,
      label: 'Status Nikah',
      autoform: {
        options: selects.nikah
      }
    },
    'regis.pendidikan': {
      type: Number,
      optional: true,
      label: 'Pendidikan Terakhir',
      autoform: {
        options: selects.pendidikan
      }
    },
    'regis.darah': {
      type: Number,
      optional: true,
      label: 'Golongan Darah',
      autoform: {
        options: selects.darah
      }
    },
    'regis.pekerjaan': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.pekerjaan
      }
    },
    'regis.alamat': {
      type: String,
      optional: true
    },
    'regis.provinsi': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.provinsi
      }
    },
    'regis.kabupaten': {
      type: Number,
      optional: true,
      label: 'Kabupaten/Kota',
      autoform: {
        options: selects.kabupaten
      }
    },
    'regis.kecamatan': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.kecamatan
      }
    },
    'regis.kelurahan': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.kelurahan
      }
    },
    'regis.kontak': {
      type: String,
      optional: true
    },
    'regis.ayah': {
      type: String,
      optional: true
    },
    'regis.ibu': {
      type: String,
      optional: true
    },
    'regis.pasangan': {
      type: String,
      optional: true,
      label: 'Suami/Istri'
    },
    'regis.tanggal': {
      type: Date,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return new Date();
      }
    }
  };
  schema.fisik = {
    tekanan_darah: {
      type: String,
      optional: true
    },
    nadi: {
      type: Number,
      optional: true
    },
    suhu: {
      type: Number,
      decimal: true,
      optional: true
    },
    pernapasan: {
      type: Number,
      optional: true
    },
    berat: {
      type: Number,
      optional: true
    },
    tinggi: {
      type: Number,
      optional: true
    },
    lila: {
      type: Number,
      optional: true
    }
  };
  schema.tindakan = {
    idtindakan: {
      type: String,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return randomId();
      }
    },
    grup: {
      type: String,
      autoform: {
        options: selects.grupTindakan
      }
    },
    nama: {
      type: String,
      autoform: {
        options: selects.namaTindakan
      }
    },
    harga: {
      type: Number,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(name, doc){
        var string, sel, that;
        string = _.initial(name.split('.')).join('.') + ".nama";
        sel = doc.find(function(it){
          return it.name === string;
        });
        if (that = sel != null ? sel.value : void 8) {
          return look2('tarif', that).harga;
        }
      }
    }
  };
  schema.obat = {
    idobat: {
      type: String,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return randomId();
      }
    },
    nama: {
      type: String,
      autoform: {
        options: selects.obat
      }
    },
    puyer: {
      type: String,
      optional: true
    },
    aturan: {
      type: Object
    },
    'aturan.kali': {
      type: Number,
      label: 'Kali sehari'
    },
    'aturan.dosis': {
      type: String
    },
    jumlah: {
      type: Number
    },
    harga: {
      type: Number,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return null;
      }
    },
    subtotal: {
      type: Number,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return null;
      }
    },
    hasil: {
      type: String,
      optional: true,
      autoform: {
        type: 'hidden'
      }
    }
  };
  schema.rawatRegis = {
    no_mr: {
      type: Number
    },
    rawat: {
      type: Array
    },
    'rawat.$': {
      type: Object
    },
    'rawat.$.idrawat': {
      type: String,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return randomId();
      }
    },
    'rawat.$.tanggal': {
      type: Date,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return new Date();
      }
    },
    'rawat.$.cara_bayar': {
      type: Number,
      autoform: {
        options: selects.cara_bayar
      }
    },
    'rawat.$.klinik': {
      type: Number,
      label: 'Poliklinik',
      autoform: {
        options: selects.klinik
      }
    },
    'rawat.$.dokter': {
      type: String,
      optional: true,
      autoform: {
        options: selects.dokter
      }
    },
    'rawat.$.billRegis': {
      type: Number,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(name, docs){
        var sel;
        sel = docs.find(function(it){
          return 'cara_bayar' === _.last(it.name.split('.'));
        });
        if ((sel != null ? sel.value : void 8) === '1') {
          return 0;
        } else {
          return 1;
        }
      }
    },
    'rawat.$.nobill': {
      type: Number,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return +_.toString(Date.now()).substr(7, 13);
      }
    },
    'rawat.$.status_bayar': {
      type: Boolean,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return false;
      }
    },
    'rawat.$.tinggal': {
      type: Number,
      optional: true,
      label: 'Pasien Tinggal',
      autoform: {
        options: selects.tinggal
      }
    },
    'rawat.$.tanggung_jawab': {
      type: String,
      optional: true
    }
  };
  schema.rawatNurse = {
    'rawat.$.anamesa_perawat': {
      type: String,
      autoform: {
        type: 'textarea'
      }
    },
    'rawat.$.fisik': {
      optional: true,
      type: new SimpleSchema(schema.fisik)
    },
    'rawat.$.cara_masuk': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.cara_masuk,
        firstLabel: 'Pilih Satu'
      }
    },
    'rawat.$.rujukan': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.rujukan
      }
    },
    'rawat.$.riwayat': {
      type: Object,
      optional: true
    },
    'rawat.$.riwayat.kesehatan': {
      type: Object,
      optional: true
    },
    'rawat.$.riwayat.kesehatan.penyakit_sebelumnya': {
      type: String,
      optional: true
    },
    'rawat.$.riwayat.kesehatan.operasi': {
      type: String,
      optional: true
    },
    'rawat.$.riwayat.kesehatan.dirawat': {
      type: String,
      optional: true
    },
    'rawat.$.riwayat.kesehatan.pengobatan_dirumah': {
      type: String,
      optional: true
    },
    'rawat.$.riwayat.kesehatan.alergi': {
      type: String,
      optional: true
    },
    'rawat.$.riwayat.kesehatan.transfusi_darah': {
      type: String,
      optional: true
    },
    'rawat.$.riwayat.kesehatan.merokok': {
      type: String,
      optional: true
    },
    'rawat.$.riwayat.kesehatan.minuman_keras': {
      type: String,
      optional: true
    },
    'rawat.$.riwayat.kesehatan.obat_terlarang': {
      type: String,
      optional: true
    },
    'rawat.$.riwayat.kesehatan.imunisasi': {
      type: String,
      optional: true,
      autoform: {
        options: selects.imunisasi
      }
    },
    'rawat.$.riwayat.keluarga': {
      type: Object,
      optional: true
    },
    'rawat.$.riwayat.keluarga.penyakit': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.penyakit
      }
    },
    'rawat.$.riwayat.keluarga.hubungan': {
      type: String,
      optional: true
    },
    'rawat.$.riwayat.reproduksi': {
      type: Object,
      optional: true
    },
    'rawat.$.riwayat.reproduksi.wanita_hamil': {
      type: Boolean,
      optional: true
    },
    'rawat.$.riwayat.reproduksi.pria_prostat': {
      type: Boolean,
      optional: true
    },
    'rawat.$.riwayat.reproduksi.keikutsertaan_kb': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.kb
      }
    },
    'rawat.$.kenyamanan': {
      type: Object,
      optional: true
    },
    'rawat.$.kenyamanan.nyeri': {
      type: Boolean,
      optional: true
    },
    'rawat.$.kenyamanan.lokasi': {
      type: String,
      optional: true
    },
    'rawat.$.kenyamanan.frekuensi': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.frekuensi
      }
    },
    'rawat.$.kenyamanan.karakteristik_nyeri': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.nyeri
      }
    },
    'rawat.$.status_psikologi': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.psikologi
      }
    },
    'rawat.$.eliminasi': {
      type: Object,
      optional: true
    },
    'rawat.$.eliminasi.bab': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.bab
      }
    },
    'rawat.$.eliminasi.bak': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.bak
      }
    },
    'rawat.$.komunikasi': {
      type: Object,
      optional: true
    },
    'rawat.$.komunikasi.bicara': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.bicara
      }
    },
    'rawat.$.komunikasi.hambatan': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.hambatan
      }
    },
    'rawat.$.komunikasi.potensial': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.potensial
      }
    }
  };
  schema.rawatDoctor = {
    'rawat.$.anamesa_dokter': {
      type: String,
      autoform: {
        type: 'textarea'
      }
    },
    'rawat.$.diagnosa': {
      type: [String]
    },
    'rawat.$.planning': {
      type: String,
      optional: true,
      autoform: {
        type: 'textarea'
      }
    },
    'rawat.$.tindakan': {
      type: [new SimpleSchema(schema.tindakan)],
      optional: true
    },
    'rawat.$.obat': {
      type: [new SimpleSchema(schema.obat)],
      optional: true
    },
    'rawat.$.spm': {
      type: Number,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return moment().diff(state.spm, 'minutes');
      }
    },
    'rawat.$.pindah': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.klinik
      }
    },
    'rawat.$.keluar': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.keluar
      }
    }
  };
  schema.rawatMR = {
    'rawat.$.icdX': {
      type: String
    }
  };
  schema.addRole = {
    roles: {
      type: String,
      optional: true,
      autoform: {
        type: 'select',
        options: function(){
          return ['admin', 'petugas', 'perawat', 'dokter', 'mr'].map(function(it){
            return {
              value: it,
              label: _.startCase(it)
            };
          });
        }
      }
    },
    group: {
      type: String,
      autoform: {
        type: 'select',
        options: function(){
          return modules.map(function(it){
            return {
              value: it.name,
              label: it.full
            };
          });
        }
      }
    },
    poli: {
      type: String,
      optional: true,
      autoform: {
        type: 'select',
        options: function(){
          return selects.klinik.map(function(it){
            return {
              label: it.label,
              value: _.snakeCase(it.label)
            };
          });
        }
      }
    }
  };
  schema.gudang = {
    idbarang: {
      type: String,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return randomId();
      }
    },
    jenis: {
      type: Number,
      autoform: {
        options: selects.barang
      }
    },
    nama: {
      type: String
    }
  };
  schema.farmasi = _.assign({}, schema.gudang, {
    kandungan: {
      type: String,
      optional: true
    },
    satuan: {
      type: Number,
      autoform: {
        options: selects.satuan
      }
    },
    batch: {
      type: Array
    },
    'batch.$': {
      type: Object
    },
    'batch.$.idbatch': {
      type: String,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return randomId();
      }
    },
    'batch.$.nobatch': {
      type: String
    },
    'batch.$.merek': {
      type: String,
      optional: true
    },
    'batch.$.masuk': {
      type: Date
    },
    'batch.$.kadaluarsa': {
      type: Date
    },
    'batch.$.digudang': {
      type: Number
    },
    'batch.$.awal': {
      type: Number,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(name, docs){
        return function(it){
          return it != null ? it.value : void 8;
        }(docs.find(function(it){
          return 'digudang' === _.last(it.name.split('.'));
        }));
      }
    },
    'batch.$.diapotik': {
      type: Number,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return 0;
      }
    },
    'batch.$.diretur': {
      type: Boolean,
      optional: true,
      autoform: {
        type: 'hidden'
      }
    },
    'batch.$.beli': {
      type: Number,
      decimal: true
    },
    'batch.$.jual': {
      type: Number,
      decimal: true,
      optional: true
    },
    'batch.$.suplier': {
      type: String,
      optional: true
    },
    'batch.$.returnable': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.returnable
      }
    },
    'batch.$.anggaran': {
      type: Number,
      optional: true,
      autoform: {
        options: selects.anggaran
      }
    },
    'batch.$.pengadaan': {
      type: Number,
      optional: true
    }
  });
  schema.amprah = function(type){
    return {
      nama: {
        type: String,
        autoform: {
          type: 'select',
          options: selects[type]
        }
      },
      jumlah: {
        type: Number
      },
      tanggal_minta: {
        type: Date,
        autoform: {
          type: 'hidden'
        },
        autoValue: function(){
          return new Date();
        }
      },
      peminta: {
        type: String,
        autoform: {
          type: 'hidden'
        },
        autoValue: function(){
          return Meteor.userId();
        }
      },
      ruangan: {
        type: String,
        autoform: {
          type: 'hidden'
        },
        autoValue: function(){
          return userGroup();
        }
      }
    };
  };
  schema.responAmprah = {
    diserah: {
      type: Number
    },
    penyerah: {
      type: String,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return Meteor.userId();
      }
    },
    tanggal_serah: {
      type: Date,
      autoform: {
        type: 'hidden'
      },
      autoValue: function(){
        return new Date();
      }
    }
  };
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"client.ls.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// client.ls.js                                                                                                        //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// Generated by LiveScript 1.5.0
var attr, comp, slice$ = [].slice;
if (Meteor.isClient) {
  attr = {
    layout: {
      hospital: 'RSUD Petala Bumi',
      rights: function(){
        return modules.filter(function(it){
          var ref$;
          return in$(it.name, _.flatMap(_.keys((ref$ = Meteor.user()) != null ? ref$.roles : void 8), function(i){
            var this$ = this;
            return function(it){
              return it.list;
            }(rights.find(function(it){
              return it.group === i;
            }));
          }));
        });
      }
    },
    pasien: {
      showForm: {
        patient: {
          onclick: function(){
            return state.showAddPatient = !state.showAddPatient;
          }
        },
        rawat: {
          onclick: function(){
            return state.showAddRawat = !state.showAddRawat;
          }
        }
      },
      headers: {
        patientList: ['tanggal_terakhir_rawat', 'no_mr', 'nama_lengkap', 'tanggal_lahir', 'tempat_lahir', 'poliklinik'],
        rawatFields: ['tanggal_berobat', 'poliklinik', 'cara_bayar', 'dokter', 'bayar_pendaftaran', 'status_bayar'],
        icdFields: ['nama_pasien', 'tanggal', 'klinik', 'dokter', 'diagnosis', 'nama_perawat', 'cek']
      },
      rawatDetails: function(doc){
        var arr, ref$;
        return arr = [
          {
            head: 'Tanggal',
            cell: hari(doc.tanggal)
          }, {
            head: 'Klinik',
            cell: look('klinik', doc.klinik).label
          }, {
            head: 'Cara Bayar',
            cell: look('cara_bayar', doc.cara_bayar).label
          }, {
            head: 'Anamesa Perawat',
            cell: doc != null ? doc.anamesa_perawat : void 8
          }, {
            head: 'Anamesa Dokter',
            cell: doc != null ? doc.anamesa_dokter : void 8
          }, {
            head: 'Diagnosa',
            cell: doc != null ? (ref$ = doc.diagnosa) != null ? ref$.join(', ') : void 8 : void 8
          }, {
            head: 'Planning',
            cell: doc != null ? doc.planning : void 8
          }
        ];
      },
      poliFilter: function(arr){
        if (arr) {
          return _.compact(arr.map(function(i){
            if (userRole() === _.snakeCase(look('klinik', i.klinik).label)) {
              return i;
            } else if (userGroup('regis')) {
              return i;
            }
          }));
        }
      },
      ownKliniks: function(){
        var ref$, ref1$;
        return (ref$ = roles()) != null ? (ref1$ = ref$.jalan) != null ? ref1$.map(function(i){
          var this$ = this;
          return function(it){
            return it.value;
          }(selects.klinik.find(function(j){
            return i === _.snakeCase(j.label);
          }));
        }) : void 8 : void 8;
      },
      lastKlinik: function(arr){
        var ref$;
        if (!((ref$ = roles()) != null && ref$.jalan)) {
          return arr;
        } else {
          if (isDr()) {
            return arr.filter(function(it){
              var list;
              return ands(list = [_.last(it.rawat).anamesa_perawat, !_.last(it.rawat).anamesa_dokter]);
            });
          } else {
            return arr.filter(function(it){
              var list;
              return ands(list = [!_.last(it.rawat).anamesa_perawat, _.last(it.rawat).billRegis]);
            });
          }
        }
      }
    },
    bayar: {
      header: ['no_mr', 'nama', 'tanggal', 'cara_bayar', 'klinik', 'aksi']
    },
    apotik: {
      header: ['no_mr', 'nama', 'tanggal', 'cara_bayar', 'klinik', 'aksi']
    },
    gudang: {
      headers: {
        farmasi: ['jenis_barang', 'nama_barang', 'batas', 'stok_diapotik', 'stok_gudang'],
        rincian: ['nobatch', 'digudang', 'diapotik', 'masuk', 'kadaluarsa']
      }
    },
    farmasi: {
      fieldSerah: ['nama_obat', 'jumlah_obat', 'aturan_kali', 'aturan_dosis'],
      search: function(it){
        return it.filter(function(i){
          return ors(['nama', 'kandungan'].map(function(j){
            return _.includes(_.lowerCase(i[j]), _.lowerCase(state.search));
          }));
        });
      }
    },
    manajemen: {
      headers: {
        tarif: ['nama', 'harga', 'first', 'second', 'third', 'active']
      },
      userList: function(){
        var arr, that;
        return pagins(_.reverse(ors(arr = [
          (that = state.search) ? Meteor.users.find({
            username: {
              $regex: ".*" + that + ".*"
            }
          }).fetch() : void 8, Meteor.users.find().fetch()
        ])));
      }
    },
    amprah: {
      headers: {
        requests: ['tanggal_minta', 'ruangan', 'peminta', 'jumlah', 'nama_barang', 'penyerah', 'diserah', 'tanggal_serah']
      },
      amprahList: function(){
        return reverse(coll.amprah.find().fetch().filter(function(i){
          if (userGroup('farmasi')) {
            return i.ruangan === 'obat';
          } else if (userGroup('jalan')) {
            return userGroup(i.ruangan);
          } else {
            return i;
          }
        }));
      },
      buttonConds: function(obj){
        var arr, ref$;
        return ands(arr = [!obj.diserah, (ref$ = userGroup()) === 'obat' || ref$ === 'farmasi', !same([userGroup(), obj.ruangan])]);
      },
      reqForm: function(){
        var arr;
        return arr = [!userGroup('farmasi') ? 'bhp' : void 8, userGroup('obat') ? 'obat' : void 8];
      }
    }
  };
  comp = {
    layout: function(comp){
      return {
        view: function(){
          var ref$, that;
          return m('div', !Meteor.userId() ? m.route.set('/login') : void 8, m('link', {
            rel: 'stylesheet',
            href: 'https:/maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'
          }), m('nav.navbar.is-info', {
            role: 'navigation',
            'aria-label': 'main navigation'
          }, m('.navbar-brand', m('a.navbar-item', {
            style: "margin-left: 600px"
          }, _.upperCase(function(it){
            return (it != null ? it.full : void 8) || attr.layout.hospital;
          }(modules.find(function(it){
            return it.name === m.route.get().split('/')[1];
          }))))), m('.navbar-end', m('.navbar-item.has-dropdown', {
            'class': state.userMenu ? 'is-active' : void 8
          }, m('a.navbar-link', {
            onclick: function(){
              return state.userMenu = !state.userMenu;
            }
          }, m('span', (ref$ = Meteor.user()) != null ? ref$.username : void 8)), m('.navbar-dropdown.is-right', function(){
            var logout, arr, ref$;
            logout = function(){
              var arr;
              return arr = [Meteor.logout(), m.route.set('/login'), m.redraw()];
            };
            arr = [
              (ref$ = Meteor.user()) != null && ref$.roles
                ? ["Grup: " + userGroup() + ", Peran: " + userRole()]
                : [''], !Meteor.userId()
                ? [
                  'Login', function(){
                    return m.route.set('/login');
                  }
                ]
                : [
                  'Logout', function(){
                    return logout();
                  }
                ]
            ];
            return arr.map(function(i){
              return m('a.navbar-item', {
                onclick: i != null ? i[1] : void 8
              }, i[0]);
            });
          }())))), m('.columns', {
            oncreate: function(){
              state.notify = {};
              return Meteor.subscribe('users', {
                onReady: function(){
                  m.redraw();
                  return attr.layout.rights().map(function(i){
                    return Meteor.call('notify', i.name, function(err, res){
                      if (res) {
                        state.notify[i.name] = res;
                        return m.redraw();
                      }
                    });
                  });
                }
              });
            }
          }, Meteor.userId() && m('.column.is-2', m('aside.menu.box', m('p.menu-label', 'Admin Menu'), m('ul.menu-list', attr.layout.rights().map(function(i){
            var that;
            return m('li', m("a#" + i.name, {
              onclick: function(e){
                if (in$(e.target.id, modules.map(function(it){
                  return it.name;
                }))) {
                  return m.route.set(i.name);
                }
              },
              'class': state.activeMenu === i.name ? 'is-active' : void 8
            }, m('span', i.full), (that = state.notify[i.name]) ? m('span', " (" + that + ")") : void 8, 'regis' === currentRoute() ? m('ul', [['lama', 'Cari Pasien'], ['baru', 'Pasien Baru']].map(function(i){
              return m('li', m("a#" + i[0], {
                onclick: function(e){
                  var ref$;
                  if ((ref$ = e.target.id) === 'baru' || ref$ === 'lama') {
                    return m.route.set("/regis/" + e.target.id);
                  }
                }
              }, m('span', _.startCase(i[1]))));
            })) : void 8, same(['manajemen', currentRoute(), i.name]) ? m('ul', ['users', 'imports'].map(function(i){
              return m('li', m('a', {
                onclick: function(){
                  return m.route.set("/manajemen/" + i);
                }
              }, m('span', _.startCase(i))));
            })) : void 8));
          })))), m('.column', (that = comp) ? m(that) : void 8)));
        }
      };
    },
    login: function(){
      return {
        view: function(){
          var that;
          return m('.container', m('.columns', m('.column'), m('.column', m('.content', m('h5', 'Login')), m('form', {
            onsubmit: function(e){
              var vals;
              e.preventDefault();
              vals = _.initial(_.map(e.target, function(it){
                return it.value;
              }));
              return Meteor.loginWithPassword.apply(Meteor, slice$.call(vals).concat([function(err){
                if (err) {
                  state.error = 'Salah Password atau Username';
                  return m.redraw();
                } else {
                  return m.route.set('/dashboard');
                }
              }]));
            }
          }, m('input.input', {
            type: 'text',
            placeholder: 'Username'
          }), m('input.input', {
            type: 'password',
            placeholder: 'Password'
          }), m('input.button.is-success', {
            type: 'submit',
            value: 'Login'
          }), (that = state.error) ? m('article.message', m('.message-header', m('p', that), m('button.delete', {
            'aria-label': 'delete'
          }))) : void 8)), m('.column')));
        }
      };
    },
    welcome: function(){
      return {
        view: function(){
          return m('.content', m('h1', 'Panduan'), m('p', 'Selamat datang di SIMRSPB 2018'));
        }
      };
    },
    pasien: function(){
      return {
        view: function(){
          var arr, ref$, that, ref1$, this$ = this;
          return m('.content', {
            oncreate: Meteor.subscribe('coll', 'daerah', {
              $and: arr = [
                {
                  provinsi: {
                    $exists: true
                  }
                }, {
                  kabupaten: {
                    $exists: false
                  }
                }
              ]
            })
          }, userGroup('regis') && userRole('admin') ? elem.report({
            title: 'Laporan Kunjungan Poliklinik',
            action: function(arg$){
              var start, end, type;
              start = arg$.start, end = arg$.end, type = arg$.type;
              return Meteor.call('visits', start, end, function(err, res){
                var that, title, obj;
                if (that = res) {
                  title = "Kunjungan " + hari(start) + " - " + hari(end);
                  obj = {
                    Tabel: csv,
                    Pdf: makePdf.csv
                  };
                  return obj[type](title, that);
                }
              });
            }
          }) : void 8, (ref$ = m.route.param('jenis')) === 'baru' || ref$ === 'edit' ? m(autoForm({
            collection: coll.pasien,
            schema: new SimpleSchema(schema.regis),
            type: m.route.param('idpasien') ? 'update' : 'insert',
            id: 'formRegis',
            doc: coll.pasien.findOne(m.route.param('idpasien')),
            buttonContent: 'Simpan',
            columns: 3,
            onchange: function(doc){
              var arr;
              if (doc.name === 'no_mr') {
                return Meteor.call('onePasien', doc.value, function(err, res){
                  if (res) {
                    afState.errors.formRegis = {
                      no_mr: 'Terpakai'
                    };
                  } else {
                    delete afState.errors.formRegis.no_mr;
                  }
                  return m.redraw();
                });
              } else if (doc.name === 'regis.provinsi') {
                return Meteor.subscribe('coll', 'daerah', {
                  $and: arr = [
                    {
                      provinsi: +doc.value
                    }, {
                      kabupaten: {
                        $exists: true
                      }
                    }
                  ]
                });
              } else if (doc.name === 'regis.kabupaten') {
                return Meteor.subscribe('coll', 'daerah', {
                  $and: arr = [
                    {
                      kabupaten: +doc.value
                    }, {
                      kecamatan: {
                        $exists: true
                      }
                    }
                  ]
                });
              } else if (doc.name === 'regis.kecamatan') {
                return Meteor.subscribe('coll', 'daerah', {
                  $and: arr = [
                    {
                      kecamatan: +doc.value
                    }, {
                      kelurahan: {
                        $exists: true
                      }
                    }
                  ]
                });
              }
            },
            hooks: {
              before: function(doc, cb){
                var ref$;
                return cb(_.merge(doc, {
                  regis: {
                    petugas: (ref$ = {}, ref$[userGroup() + ""] = Meteor.userId(), ref$),
                    provinsi: function(it){
                      return it != null ? it.daerah : void 8;
                    }(coll.daerah.findOne({
                      provinsi: doc.provinsi
                    })),
                    kabupaten: function(it){
                      return it != null ? it.daerah : void 8;
                    }(coll.daerah.findOne({
                      provinsi: doc.provinsi,
                      kabupaten: doc.kabupaten
                    })),
                    kecamatan: function(it){
                      return it != null ? it.daerah : void 8;
                    }(coll.daerah.findOne({
                      kabupaten: doc.kabupaten,
                      kecamatan: doc.kecamatan
                    })),
                    kelurahan: function(it){
                      return it != null ? it.daerah : void 8;
                    }(coll.daerah.findOne({
                      kecamatan: doc.kecamatan,
                      kelurahan: doc.kelurahan
                    }))
                  }
                }));
              },
              after: function(id){
                state.showAddPatient = null;
                return m.route.set("/regis/lama/" + id);
              }
            }
          })) : void 8, userRole('mr')
            ? m('div', m('br', {
              oncreate: function(){
                return Meteor.subscribe('coll', 'tarif');
              }
            }), m('form.columns', {
              onsubmit: function(e){
                e.preventDefault();
                return Meteor.call('onePasien', e.target[0].value, function(err, res){
                  if (res) {
                    return makePdf.icdx(res);
                  }
                });
              }
            }, m('.column', m('input.input', {
              type: 'text',
              placeholder: 'No MR Pasien'
            })), m('.column', m('input.button.is-primary', {
              type: 'submit',
              value: 'Unduh'
            }))), m('h5', 'Kodifikasi ICD 10'), m('table.table', {
              oncreate: function(){
                return Meteor.subscribe('coll', 'pasien', {
                  rawat: {
                    $elemMatch: {
                      $and: [
                        {
                          'anamesa_dokter': {
                            $exists: true
                          }
                        }, {
                          icdx: {
                            $exists: false
                          }
                        }
                      ]
                    }
                  }
                }, {
                  onReady: function(){
                    return m.redraw();
                  }
                });
              }
            }, m('thead', attr.pasien.headers.icdFields.map(function(i){
              return m('th', _.startCase(i));
            })), m('tbody', coll.pasien.find().fetch().map(function(i){
              return i.rawat.map(function(j){
                var arr, ref$;
                if (j.anamesa_dokter && !j.icdx) {
                  return m('tr', tds(arr = [
                    i.regis.nama_lengkap, hari(j.tanggal), look('klinik', j.klinik).label, '-', (ref$ = j.diagnosa) != null ? ref$[0] : void 8, '-', m('.button.is-info', {
                      onclick: function(){
                        return state.modal = _.merge({
                          rawat: j,
                          pasien: i
                        });
                      }
                    }, m('span', 'Cek'))
                  ]));
                }
              });
            }))), (that = state.modal) ? elem.modal({
              title: 'Kodekan ICD 10',
              content: m('div', m('table.table', that.rawat.diagnosa.map(function(i, j){
                return m('tr', [m('td', j + 1), m('td', _.startCase(i))]);
              })), m(autoForm({
                schema: new SimpleSchema({
                  icdx: {
                    type: [String]
                  }
                }),
                type: 'method',
                meteormethod: 'icdX',
                hooks: {
                  before: function(doc, cb){
                    return cb(_.merge({}, state.modal, doc));
                  },
                  after: function(){
                    state.modal = null;
                    return m.redraw();
                  }
                }
              })))
            }) : void 8)
            : (ref$ = m.route.get()) === '/regis/lama' || ref$ === '/jalan'
              ? m('div', userGroup('regis') && m('form', {
                onsubmit: function(e){
                  var byName, byNoMR;
                  e.preventDefault();
                  if (e.target[0].value.length > 3) {
                    byName = {
                      'regis.nama_lengkap': {
                        $options: '-i',
                        $regex: ".*" + e.target[0].value + ".*"
                      }
                    };
                    byNoMR = {
                      no_mr: +e.target[0].value
                    };
                    return Meteor.subscribe('coll', 'pasien', {
                      $or: [byName, byNoMR]
                    }, {
                      limit: 30
                    }, {
                      onReady: function(){
                        return m.redraw();
                      }
                    });
                  }
                }
              }, m('input.input', {
                type: 'text',
                placeholder: 'Pencarian'
              })), m('table.table', {
                oncreate: function(){
                  return Meteor.subscribe('users', {
                    onReady: function(){
                      var onKlinik;
                      onKlinik = {
                        rawat: {
                          $elemMatch: {
                            klinik: {
                              $in: attr.pasien.ownKliniks()
                            }
                          }
                        }
                      };
                      return Meteor.subscribe('coll', 'pasien', onKlinik, {
                        onReady: function(){
                          return m.redraw();
                        }
                      });
                    }
                  });
                }
              }, m('thead', m('tr', attr.pasien.headers.patientList.map(function(i){
                return m('th', _.startCase(i));
              }))), m('tbody', attr.pasien.lastKlinik(coll.pasien.find().fetch()).map(function(i){
                var rows, ref$, ref1$, ref2$;
                rows = function(){
                  var arr, that, ref$, ref1$, ref2$;
                  if (i.no_mr) {
                    return m('tr', {
                      ondblclick: function(){
                        return m.route.set(m.route.get() + "/" + i._id);
                      }
                    }, tds(arr = [(that = (ref$ = i.rawat) != null ? (ref1$ = ref$[((ref2$ = i.rawat) != null ? ref2$.length : void 8) - 1]) != null ? ref1$.tanggal : void 8 : void 8) ? hari(that) : void 8, i.no_mr, i.regis.nama_lengkap, (that = i.regis.tgl_lahir) ? moment(that).format('D MMM YYYY') : void 8, (that = i.regis.tmpt_lahir) ? _.startCase(that) : void 8, _.startCase(userRole())]));
                  }
                };
                if (currentRoute() === 'jalan') {
                  if ((ref$ = i.rawat) != null && ((ref1$ = ref$.reverse()) != null && ((ref2$ = ref1$[0]) != null && ref2$.billRegis))) {
                    return rows();
                  }
                } else {
                  return rows();
                }
              }))), userGroup('jalan') && !isDr() ? m('div', m('h5', 'Daftar Antrian Panggilan Dokter'), m('table.table', m('thead', m('tr', attr.pasien.headers.patientList.map(function(i){
                return m('th', _.startCase(i));
              }))), m('tbody', coll.pasien.find().fetch().map(function(i){
                var doneByNurse, arr;
                doneByNurse = function(){
                  var arr;
                  return ands(arr = [i.rawat[i.rawat.length - 1].anamesa_perawat, !i.rawat[i.rawat.length - 1].anamesa_dokter]);
                };
                if (doneByNurse()) {
                  return m('tr', tds(arr = [hari(i.rawat[i.rawat.length - 1].tanggal), i.no_mr, i.regis.nama_lengkap, hari(i.regis.tgl_lahir), i.regis.tmpt_lahir, _.startCase(userRole())]));
                }
              })))) : void 8)
              : m.route.param('idpasien')
                ? m('div', {
                  oncreate: function(){
                    Meteor.subscribe('coll', 'tarif');
                    Meteor.subscribe('coll', 'gudang');
                    Meteor.subscribe('coll', 'pasien', {
                      _id: m.route.param('idpasien')
                    }, {
                      onReady: function(){
                        return m.redraw();
                      }
                    });
                    return isDr() && Meteor.subscribe('users', {
                      username: {
                        $options: '-i',
                        $regex: '^dr'
                      }
                    });
                  }
                }, m('.content', m('h5', 'Rincian Pasien')), (that = coll.pasien.findOne(m.route.param('idpasien'))) ? m('div', m('table.table', [
                  [
                    {
                      name: 'No. MR',
                      data: that.no_mr
                    }, {
                      name: 'Tanggal Lahir',
                      data: hari(that.regis.tgl_lahir)
                    }
                  ], [
                    {
                      name: 'Nama Lengkap',
                      data: _.startCase(that.regis.nama_lengkap)
                    }, {
                      name: 'Tempat Lahir',
                      data: _.startCase(that.regis.tmpt_lahir)
                    }
                  ], [
                    {
                      name: 'Tempat Tinggal',
                      data: _.startCase(that.regis.alamat)
                    }, {
                      name: 'Umur',
                      data: moment().diff(that.regis.tgl_lahir, 'years') + ' tahun'
                    }
                  ]
                ].map(function(i){
                  return m('tr', i.map(function(j){
                    return [m('th', j.name), m('td', j.data)];
                  }));
                })), currentRoute() === 'regis' ? m('div', [
                  [
                    'Kartu', 'is-info', {
                      onclick: function(){
                        return makePdf.card(m.route.param('idpasien'));
                      }
                    }
                  ], [
                    'Consent', 'is-info', {
                      onclick: function(){
                        return makePdf.consent();
                      }
                    }
                  ], [
                    'Edit', 'is-warning', {
                      onclick: function(){
                        return m.route.set("/regis/edit/" + m.route.param('idpasien'));
                      }
                    }
                  ], ['+Rawat Jalan', 'is-success', attr.pasien.showForm.rawat]
                ].map(function(i){
                  return m(".button." + i[1], _.merge({
                    style: 'margin-right: 10px'
                  }, i[2]), i[0]);
                })) : void 8, state.showAddRawat && m(autoForm({
                  collection: coll.pasien,
                  schema: new SimpleSchema(schema.rawatRegis),
                  type: 'update-pushArray',
                  id: 'formJalan',
                  scope: 'rawat',
                  doc: that,
                  buttonContent: 'Simpan',
                  columns: 3,
                  hooks: {
                    before: function(doc, cb){
                      var ref$;
                      return cb(_.merge(doc, {
                        petugas: (ref$ = {}, ref$[userGroup() + ""] = Meteor.userId(), ref$)
                      }));
                    },
                    after: function(){
                      state.showAddRawat = false;
                      return m.redraw();
                    }
                  }
                })), [0, 1].map(function(){
                  return m('br');
                }), state.docRawat && m('.content', m('h5', 'Rincian Rawat'), m('table.table', attr.pasien.rawatDetails(that.rawat.find(function(it){
                  return it.idrawat === state.docRawat;
                })).map(function(i){
                  return i.cell && m('tr', [m('th', i.head), m('td', i.cell)]);
                }))), state.docRawat && m(autoForm({
                  collection: coll.pasien,
                  schema: new SimpleSchema(isDr()
                    ? schema.rawatDoctor
                    : schema.rawatNurse),
                  type: 'update-pushArray',
                  id: 'formNurse',
                  scope: 'rawat',
                  doc: that,
                  buttonContent: 'Simpan',
                  columns: 3,
                  hooks: {
                    before: function(doc, cb){
                      var base;
                      base = that.rawat.find(function(it){
                        return it.idrawat === state.docRawat;
                      });
                      return Meteor.call('rmRawat', that._id, state.docRawat, function(err, res){
                        var arr, ref$;
                        return res && cb(_.merge(doc.rawat[0], base, {
                          status_bayar: ors(arr = [base.cara_bayar !== 1, ands(arr = [doc.rawat[0].obat, !doc.rawat[0].tindakan])]) ? true : void 8,
                          petugas: (ref$ = {}, ref$[(isDr() ? 'dokter' : 'perawat') + ""] = Meteor.userId(), ref$)
                        }));
                      });
                    },
                    after: function(doc){
                      var that;
                      if (that = doc.pindah) {
                        coll.pasien.update({
                          _id: m.route.param('idpasien')
                        }, {
                          $push: {
                            rawat: {
                              klinik: that,
                              billRegis: doc.billRegis,
                              cara_bayar: doc.cara_bayar,
                              idrawat: randomId(),
                              petugas: doc.petugas,
                              tanggal: new Date()
                            }
                          }
                        });
                      }
                      state.docRawat = null;
                      return m.redraw();
                    }
                  }
                })), m('table.table', m('thead', m('tr', attr.pasien.headers.rawatFields.map(function(i){
                  return m('th', _.startCase(i));
                }), userGroup('jalan') ? m('th', 'Rincian') : void 8, userRole('admin') ? m('th', 'Hapus') : void 8)), m('tbody', (ref$ = attr.pasien.poliFilter(that != null ? (ref1$ = that.rawat) != null ? ref1$.reverse() : void 8 : void 8)) != null ? ref$.map(function(i){
                  var that, ref$;
                  return m('tr', [hari(i.tanggal), look('klinik', i.klinik).label, look('cara_bayar', i.cara_bayar).label, (that = i.dokter) ? _.startCase((ref$ = Meteor.users.findOne(that)) != null ? ref$.username : void 8) : void 8].concat(
                    slice$.call(['billRegis', 'status_bayar'].map(function(it){
                      if (i[it]) {
                        return 'Sudah';
                      } else {
                        return 'Belum';
                      }
                    })), [
                      userGroup('jalan') ? m('button.button.is-info', {
                        onclick: function(){
                          return state.modal = i;
                        }
                      }, m('span', 'Lihat')) : void 8, userRole('admin') ? m('.button.is-danger', {
                        ondblclick: function(){
                          return Meteor.call('rmRawat', coll.pasien.findOne({
                            _id: m.route.param('idpasien')
                          })._id, i.idrawat, function(err, res){
                            return res && m.redraw();
                          });
                        }
                      }, m('span', 'Hapus')) : void 8
                    ]
                  ).map(function(j){
                    return m('td', j) || '-';
                  }));
                }) : void 8)), state.modal ? elem.modal({
                  title: 'Rincian rawat',
                  content: m('div', m('h1', function(it){
                    return it.regis.nama_lengkap;
                  }(coll.pasien.findOne(m.route.param('idpasien')))), m('table.table', attr.pasien.rawatDetails(state.modal).map(function(i){
                    return i.cell && m('tr', [m('th', i.head), m('td', i.cell)]);
                  })), (that = state.modal.fisik) ? m('div', m('br'), m('table', m('tr', m('th', 'Fisik'))), m('table.table', m('thead', m('tr', _.map(that, function(v, k){
                    return m('th', _.startCase(k));
                  }))), m('tbody', m('tr', _.map(that, function(v, k){
                    return m('td', v);
                  }))))) : void 8, (that = state.modal.tindakan) ? m('div', m('br'), m('table', m('tr', m('th', 'Tindakan'))), m('table.table', that != null ? that.map(function(i){
                    var arr;
                    return m('tr', tds(arr = [_.startCase(look2('tarif', i.nama).nama), rupiah(i.harga)]));
                  }) : void 8, m('tr', m('th', 'Total'), m('td', rupiah(_.sum(that.map(function(it){
                    return it.harga;
                  }))))))) : void 8, (that = state.modal.obat) ? m('div', m('br'), m('table', m('tr', m('th', 'Obat'))), m('table.table', that.map(function(i){
                    var arr, that;
                    return m('tr', tds(arr = [_.startCase(look2('gudang', i.nama).nama), i.aturan.kali + " kali", i.aturan.dosis + " dosis", i.jumlah + " unit", (that = i.puyer) ? "puyer " + that : void 8]));
                  }))) : void 8),
                  confirm: ands(arr = [currentRoute() === 'jalan', !isDr() ? !state.modal.anamesa_perawat : true, isDr() ? state.modal.anamesa_perawat : true, isDr() ? !state.modal.anamesa_dokter : true]) ? 'Lanjutkan' : void 8,
                  action: function(){
                    state.docRawat = state.modal.idrawat;
                    state.spm = new Date();
                    return state.modal = null;
                  }
                }) : void 8) : void 8)
                : m('div'));
        }
      };
    },
    regis: function(){
      return this.pasien;
    },
    jalan: function(){
      return this.pasien;
    },
    bayar: function(){
      return {
        view: function(){
          var that, tindakans, ref$, uraian, arr, ref1$, ref2$, params;
          return m('.content', m('table.table', {
            oncreate: function(){
              Meteor.subscribe('coll', 'tarif');
              return Meteor.subscribe('coll', 'pasien', {
                rawat: {
                  $elemMatch: {
                    $or: [
                      {
                        billRegis: {
                          $ne: true
                        }
                      }, {
                        status_bayar: {
                          $ne: true
                        }
                      }
                    ]
                  }
                }
              }, {
                onReady: function(){
                  return m.redraw();
                }
              });
            }
          }, m('thead', m('tr', attr.bayar.header.map(function(i){
            return m('th', _.startCase(i));
          }))), m('tbody', coll.pasien.find().fetch().map(function(i){
            return _.compact(i.rawat.map(function(j){
              var conds, arr;
              conds = ors(arr = [!j.billRegis, j.tindakan ? !j.status_bayar : void 8]);
              if (j.cara_bayar === 1) {
                if (conds) {
                  return m('tr', [
                    i.no_mr, i.regis.nama_lengkap, hari(j.tanggal), look('cara_bayar', j.cara_bayar).label, look('klinik', j.klinik).label, m('a.button.is-success', {
                      onclick: function(){
                        return state.modal = _.merge(j, {
                          pasienId: i._id
                        });
                      }
                    }, m('span', 'Bayar'))
                  ].map(function(k){
                    return m('td', k);
                  }));
                }
              }
            }));
          }))), (that = state.modal) ? (tindakans = (ref$ = state.modal.tindakan) != null ? ref$.map(function(it){
            var arr;
            return arr = [_.startCase(look2('tarif', it.nama).nama), it.harga];
          }) : void 8, uraian = [ands(arr = [!((ref1$ = coll.pasien.findOne(state.modal.pasienId).rawat) != null && ((ref2$ = ref1$[0]) != null && ref2$.billRegis)), coll.pasien.findOne(state.modal.pasienId).regis.petugas]) ? ['Cetak Kartu', 10000] : void 8, !state.modal.billRegis ? ['Konsultasi Spesialis', look('karcis', that.klinik).label * 1000] : void 8].concat(slice$.call(tindakans || [])), params = ['pasienId', 'idrawat'].map(function(it){
            return state.modal[it];
          }), elem.modal({
            title: 'Sudah bayar?',
            content: m('table.table', uraian.map(function(i){
              if (i) {
                return m('tr', [m('th', i[0]), m('td', rupiah(i[1]))]);
              }
            }), m('tr', [
              m('th', 'Total Biaya'), m('td', rupiah(_.sum(uraian.map(function(it){
                return it != null ? it[1] : void 8;
              }))))
            ])),
            confirm: 'Sudah',
            action: function(){
              Meteor.call('updateArrayElm', {
                name: 'pasien',
                recId: that.pasienId,
                scope: 'rawat',
                elmId: that.idrawat,
                doc: _.merge(that, !that.billRegis
                  ? {
                    billRegis: true
                  }
                  : !that.status_bayar ? {
                    status_bayar: true
                  } : void 8)
              });
              if (!that.anamesa_perawat) {
                makePdf.payRegCard.apply(makePdf, slice$.call(params).concat([_.compact(uraian)]));
              } else {
                makePdf.payRawat.apply(makePdf, slice$.call(params).concat([_.compact(uraian)]));
              }
              state.modal = null;
              return m.redraw();
            }
          })) : void 8, userRole('admin') ? elem.report({
            title: 'Laporan Pemasukan',
            action: function(arg$){
              var start, end, type;
              start = arg$.start, end = arg$.end, type = arg$.type;
              return Meteor.call('incomes', start, end, function(err, res){
                var that, title, obj;
                if (that = res) {
                  title = "Pemasukan " + hari(start) + " - " + hari(end);
                  obj = {
                    Tabel: csv,
                    Pdf: makePdf.csv
                  };
                  return obj[type](title, that);
                }
              });
            }
          }) : void 8);
        }
      };
    },
    obat: function(){
      return {
        view: function(){
          var that;
          return m('.content', m('h5', 'Apotik', m('table.table', {
            oncreate: function(){
              Meteor.subscribe('coll', 'gudang');
              Meteor.subscribe('coll', 'rekap', {
                printed: {
                  $exists: false
                }
              });
              return Meteor.subscribe('coll', 'pasien', {
                rawat: {
                  $elemMatch: {
                    obat: {
                      $elemMatch: {
                        hasil: {
                          $exists: false
                        }
                      }
                    }
                  }
                }
              }, {
                onReady: function(){
                  return m.redraw();
                }
              });
            }
          }, m('thead', attr.apotik.header.map(function(i){
            return m('th', _.startCase(i));
          })), m('tbody', coll.pasien.find().fetch().map(function(i){
            return i.rawat.map(function(j){
              var okay, arr;
              okay = function(){
                if (j.cara_bayar === 1) {
                  return j.status_bayar && !j.givenDrug;
                } else {
                  return !j.givenDrug;
                }
              };
              return okay() && m('tr', tds(arr = [
                i.no_mr, i.regis.nama_lengkap, hari(j.tanggal), look('cara_bayar', j.cara_bayar).label, look('klinik', j.klinik).label, m('.button.is-success', {
                  onclick: function(){
                    return state.modal = _.merge(j, i);
                  }
                }, m('span', 'Serah'))
              ]));
            });
          })))), (that = state.modal) ? elem.modal({
            title: 'Serahkan Obat?',
            content: m('table.table', m('tr', attr.farmasi.fieldSerah.map(function(i){
              return m('th', _.startCase(i));
            })), that.obat.map(function(i){
              var arr;
              return m('tr', tds(arr = [look2('gudang', i.nama).nama, i.jumlah + " unit", i.aturan.kali + " kali", i.aturan.dosis + " unit"]));
            })),
            confirm: 'Serahkan',
            action: function(){
              return Meteor.call('serahObat', state.modal, function(err, res){
                if (res) {
                  coll.pasien.update(state.modal._id, {
                    $set: {
                      rawat: coll.pasien.findOne(state.modal._id).rawat.map(function(i){
                        if (i.idrawat === state.modal.idrawat) {
                          return _.assign(i, {
                            givenDrug: true
                          });
                        } else {
                          return i;
                        }
                      })
                    }
                  });
                  res.map(function(it){
                    return coll.rekap.insert(it);
                  });
                  state.modal = null;
                  return m.redraw();
                }
              });
            }
          }) : void 8, m('.button.is-warning', {
            onclick: function(){
              return makePdf.rekap();
            }
          }, m('span', 'Cetak Rekap')), [0, 1, 2].map(function(){
            return m('br');
          }), userRole('admin') ? elem.report({
            title: 'Laporan Pengeluaran Obat',
            action: function(arg$){
              var start, end, type;
              start = arg$.start, end = arg$.end, type = arg$.type;
              return Meteor.call('dispenses', start, end, function(err, res){
                if (res) {
                  return csv("Pengeluaran Obat " + hari(start) + "-" + hari(end), res);
                }
              });
            }
          }) : void 8);
        }
      };
    },
    farmasi: function(){
      return {
        view: function(){
          var ref$, that, ref1$, ref2$;
          return m('.content', userGroup('farmasi') && userRole('admin') ? elem.report({
            title: 'Laporan Stok Barang',
            action: function(arg$){
              var start, end, type;
              start = arg$.start, end = arg$.end, type = arg$.type;
              return Meteor.call('stocks', start, end, function(err, res){
                var that, title, obj;
                if (that = res) {
                  title = "Stok Barang " + hari(start) + " - " + hari(end);
                  obj = {
                    Tabel: csv,
                    Pdf: makePdf.csv
                  };
                  return obj[type](title, that);
                }
              });
            }
          }) : void 8, !m.route.param('idbarang')
            ? m('div', m('form', {
              onsubmit: function(e){
                e.preventDefault();
                return state.search = _.lowerCase(e.target[0].value);
              }
            }, m('input.input', {
              type: 'text',
              placeholder: 'Pencarian'
            })), (ref$ = roles()) != null && ref$.farmasi ? m('button.button.is-success', {
              onclick: function(){
                return state.showForm = !state.showForm;
              }
            }, m('span', '+Tambah Jenis Barang')) : void 8, state.showForm ? (m('h5', 'Form Barang Farmasi'), m(autoForm({
              collection: coll.gudang,
              schema: new SimpleSchema(schema.farmasi),
              type: 'insert',
              id: 'formFarmasi',
              buttonContent: 'Simpan',
              columns: 3,
              hooks: {
                after: function(){
                  state.showForm = null;
                  return m.redraw();
                }
              }
            }))) : void 8, m('table.table', {
              oncreate: function(){
                return Meteor.subscribe('coll', 'gudang', {
                  onReady: function(){
                    return m.redraw();
                  }
                });
              }
            }, m('thead', m('tr', attr.gudang.headers.farmasi.map(function(i){
              return m('th', _.startCase(i));
            }))), m('tbody', attr.farmasi.search(coll.gudang.find().fetch()).map(function(i){
              return m('tr', {
                'class': i.treshold > _.sumBy(i.batch, 'diapotik') ? 'has-text-danger' : void 8,
                ondblclick: function(){
                  return m.route.set("/farmasi/" + i._id);
                }
              }, m('td', look('barang', i.jenis).label), m('td', i.nama), m('td', i.treshold), ['diapotik', 'digudang'].map(function(j){
                return m('td', _.sumBy(i.batch, j));
              }));
            }))))
            : m('div', {
              oncreate: function(){
                return Meteor.subscribe('coll', 'gudang', {
                  _id: m.route.param('idbarang')
                }, {
                  onReady: function(){
                    return m.redraw();
                  }
                });
              }
            }, m('h5', 'Rincian Obat'), m('table.table', (that = coll.gudang.findOne(m.route.param('idbarang'))) ? [
              [
                {
                  name: 'Nama Barang',
                  cell: that.nama
                }, {
                  name: 'Jenis Barang',
                  cell: look('barang', that.jenis).label
                }
              ], [
                {
                  name: 'Kandungan',
                  cell: that.kandungan
                }, {
                  name: 'Satuan',
                  cell: look('satuan', that.satuan).label
                }
              ]
            ].map(function(i){
              return m('tr', i.map(function(j){
                return [m('th', j.name), m('td', j.cell)];
              }));
            }) : void 8, m('tr', {
              ondblclick: function(){
                if (userGroup('obat')) {
                  return state.modal = coll.gudang.findOne(m.route.param('idbarang'));
                }
              }
            }, m('th', 'Batas Minimum'), m('td', that != null ? that.treshold : void 8))), state.modal && elem.modal({
              title: 'Tetapkan Treshold',
              content: m('div', m('h5', 'Berapa batas minimum yang seharusnya ada di apotik?'), m('form', {
                onsubmit: function(e){
                  e.preventDefault();
                  coll.gudang.update(state.modal._id, {
                    $set: {
                      treshold: +e.target[0].value
                    }
                  });
                  state.modal = null;
                  return m.redraw();
                }
              }, m('.field', m('.control', m('input.input', {
                type: 'number',
                placeholder: 'Minimum'
              }))), m('.field', m('.control', m('input.button.is-success', {
                type: 'submit',
                value: 'Tetapkan'
              })))))
            }), (ref1$ = roles()) != null && ref1$.farmasi ? m('.button.is-warning', {
              onclick: function(){
                return state.showForm = !state.showForm;
              }
            }, m('span', 'Tambahkan Batch')) : void 8, state.showForm ? m(autoForm({
              collection: coll.gudang,
              schema: new SimpleSchema(schema.farmasi),
              type: 'update-pushArray',
              scope: 'batch',
              doc: coll.gudang.findOne(m.route.param('idbarang')),
              id: 'formTambahObat',
              buttonContent: 'Tambahkan',
              columns: 3,
              hooks: {
                after: function(){
                  Meteor.call('sortByDate', m.route.param('idbarang'));
                  state.showForm = null;
                  return m.redraw();
                }
              }
            })) : void 8, m('table.table', m('thead', attr.gudang.headers.rincian.map(function(i){
              return m('th', _.startCase(i));
            })), m('tbody', (ref2$ = coll.gudang.findOne(m.route.param('idbarang'))) != null ? ref2$.batch.map(function(i){
              return m('tr', [i.nobatch, i.digudang, i.diapotik, hari(i.masuk), hari(i.kadaluarsa)].map(function(j){
                return m('td', j);
              }));
            }) : void 8))));
        }
      };
    },
    manajemen: function(){
      return {
        view: function(){
          if ('users' === m.route.param('subroute')) {
            return m('.content', {
              oncreate: function(){
                return Meteor.subscribe('users', {
                  onReady: function(){
                    return m.redraw();
                  }
                });
              }
            }, m('h1', 'Manajemen Pengguna'), m('h5', 'Tambahkan pengguna baru'), m('form', {
              onsubmit: function(e){
                var vals;
                e.preventDefault();
                vals = _.initial(_.map(e.target, function(it){
                  return it.value;
                }));
                if (vals[1] === vals[2]) {
                  return Meteor.call('newUser', {
                    username: vals[0],
                    password: vals[1]
                  }, function(err, res){
                    return res && m.redraw();
                  });
                }
              }
            }, [
              {
                type: 'text',
                place: 'Username'
              }, {
                type: 'password',
                place: 'Password'
              }, {
                type: 'password',
                place: 'Ulangi password'
              }
            ].map(function(i){
              return m('.field', m('.control', m('input.input', {
                type: i.type,
                placeholder: i.place
              })));
            }), m('.field', m('.control', m('input.button', {
              type: 'submit',
              value: 'Daftarkan'
            })))), [0, 1].map(function(){
              return m('br');
            }), m('h5', 'Daftar Pengguna Sistem'), m('form', {
              onkeypress: function(e){
                return state.search = e.target.value;
              }
            }, m('input.input', {
              type: 'text',
              placeholder: 'Pencarian'
            })), m('table.table', {
              oncreate: function(){
                return Meteor.subscribe('users', {
                  onReady: function(){
                    return m.redraw();
                  }
                });
              }
            }, m('thead', m('tr', ['Username', 'Peran', 'Aksi'].map(function(i){
              return m('th', i);
            }))), m('tbody', attr.manajemen.userList().map(function(i){
              return m('tr', {
                ondblclick: function(){
                  return state.modal = i;
                }
              }, m('td', i.username), m('td', JSON.stringify(i.roles)), m('td', m('.button.is-danger', {
                onclick: function(){
                  return Meteor.call('rmRole', i._id);
                }
              }, m('span', 'Reset'))));
            })), state.modal ? elem.modal({
              title: 'Berikan Peranan',
              content: m(autoForm({
                schema: new SimpleSchema(schema.addRole),
                type: 'method',
                meteormethod: 'addRole',
                id: 'formAddRole',
                buttonContent: 'Beri',
                columns: 3,
                hooks: {
                  before: function(doc, cb){
                    return cb(_.merge(doc, {
                      id: state.modal._id
                    }));
                  },
                  after: function(){
                    state.modal = null;
                    return m.redraw();
                  }
                }
              }))
            }) : void 8), elem.pagins());
          } else if ('imports' === m.route.param('subroute')) {
            return m('.content', m('h1', 'Importer Data'), m('h5', 'Unggah data csv'), m('.file', m('label.file-label', m('input.file-input', {
              type: 'file',
              name: 'csv',
              onchange: function(e){
                return Papa.parse(e.target.files[0], {
                  header: true,
                  step: function(result){
                    var data, sel, opt, that;
                    data = result.data[0];
                    if (data.no_mr) {
                      sel = {
                        no_mr: +data.no_mr
                      };
                      opt = {
                        regis: {
                          nama_lengkap: _.startCase(data.nama_lengkap),
                          alamat: (that = data.alamat) ? _.startCase(that) : void 8,
                          agama: (that = data.agama) ? +that : void 8,
                          ayah: (that = data.ayah) ? _.startCase(that) : void 8,
                          nikah: (that = data.nikah) ? +that : void 8,
                          pekerjaan: (that = data.pekerjaan) ? +that : void 8,
                          pendidikan: (that = data.pendidikan) ? +that : void 8,
                          tgl_lahir: (that = data.tgl_lahir) ? (that = Date.parse(that)) ? new Date(that) : void 8 : void 8,
                          tmpt_lahir: (that = data.tmpt_lahir) ? _.startCase(that) : void 8
                        }
                      };
                      Meteor.call('import', 'pasien', sel, opt);
                    }
                    if (data.digudang) {
                      sel = {
                        nama: data.nama
                      };
                      opt = {
                        jenis: +data.jenis,
                        satuan: +data.satuan,
                        nobatch: (that = data.nobatch) ? that : void 8,
                        merek: (that = data.merek) ? that : void 8,
                        masuk: (that = data.masuk) ? new Date(that) : void 8,
                        kadaluarsa: (that = data.kadaluarsa) ? new Date(that) : void 8,
                        digudang: +data.digudang,
                        diapotik: (that = data.diapotik) ? +that : void 8,
                        diretur: (that = data.diretur) ? +that : void 8,
                        beli: (that = data.beli) ? +that : void 8,
                        jual: (that = data.jual) ? +that : void 8,
                        suplier: (that = data.suplier) ? that : void 8,
                        returnable: (that = data.returnable) ? !!that : void 8,
                        anggaran: (that = data.anggaran) ? +that : void 8,
                        pengadaan: (that = data.pengadaan) ? that : void 8,
                        no_spk: (that = data.no_spk) ? that : void 8,
                        tanggal_spk: (that = data.tanggal_spk) ? new Date(that) : void 8
                      };
                      Meteor.call('import', 'gudang', sel, opt);
                    }
                    if (data.harga) {
                      sel = {
                        nama: _.snakeCase(data.nama)
                      };
                      opt = {
                        harga: +data.harga,
                        first: data.first,
                        second: data.second,
                        third: (that = data.third) ? that : void 8,
                        active: true
                      };
                      Meteor.call('import', 'tarif', sel, opt);
                    }
                    if (data.password) {
                      ['newUser', 'importRoles'].map(function(i){
                        return Meteor.call(i, data);
                      });
                    }
                    if (data.daerah) {
                      return coll.daerah.insert({
                        daerah: _.lowerCase(data.daerah),
                        provinsi: (that = data.provinsi) ? +that : void 8,
                        kabupaten: (that = data.kabupaten) ? +that : void 8,
                        kecamatan: (that = data.kecamatan) ? +that : void 8,
                        kelurahan: (that = data.kelurahan) ? +that : void 8
                      });
                    }
                  }
                });
              }
            }), m('span.file-cta', m('span.file-icon', m('i.fa.fa-upload')), m('span.file-label', 'Pilih file .csv')))), [0, 1].map(function(){
              return m('br');
            }), m('h5', 'Daftar Tarif Tindakan'), m('table.table', {
              oncreate: function(){
                return Meteor.subscribe('coll', 'tarif', {
                  onReady: function(){
                    return m.redraw();
                  }
                });
              }
            }, m('thead', m('tr', attr.manajemen.headers.tarif.map(function(i){
              return m('th', _.startCase(i));
            }))), m('tbody', pagins(coll.tarif.find().fetch()).map(function(i){
              var arr;
              return m('tr', tds(arr = [_.startCase(i.nama), rupiah(i.harga), _.startCase(i.first), _.startCase(i.second), _.startCase(i.third), i.active]));
            }))), elem.pagins());
          }
        }
      };
    },
    amprah: function(){
      return {
        view: function(){
          var arr;
          return m('.content', {
            oncreate: function(){
              Meteor.subscribe('coll', 'gudang', {
                onReady: function(){
                  return m.redraw();
                }
              });
              return state.showForm = {
                obat: false,
                bhp: false
              };
            }
          }, _.compact(attr.amprah.reqForm()).map(function(type){
            var ref$;
            return m('div', [0].map(function(i){
              return m('br');
            }), m('.button.is-primary', {
              onclick: function(){
                return state.showForm[type] = !state.showForm[type];
              }
            }, m('span', "Request " + _.upperCase(type))), ((ref$ = state.showForm) != null && ref$[type]) && !userGroup('farmasi') ? (m('h5', 'Form Amprah'), m(autoForm({
              collection: coll.amprah,
              schema: new SimpleSchema(schema.amprah(type)),
              type: 'insert',
              id: "formAmprah" + type,
              columns: 2,
              hooks: {
                after: function(){
                  state.showForm = null;
                  return m.redraw();
                }
              }
            }))) : void 8);
          }), m('br'), m('h5', 'Daftar Amprah'), m('table.table', {
            oncreate: function(){
              var cond;
              cond = function(){
                if (userGroup('obat')) {
                  return {
                    penyerah: {
                      $exists: false
                    }
                  };
                } else if (userGroup('farmasi')) {
                  return {
                    ruangan: 'apotik'
                  };
                } else {
                  return {
                    ruangan: userGroup()
                  };
                }
              };
              return Meteor.subscribe('coll', 'amprah', cond(), {
                onReady: function(){
                  return m.redraw();
                }
              });
            }
          }, m('thead', m('tr', attr.amprah.headers.requests.map(function(i){
            return m('th', _.startCase(i));
          }), userGroup('obat') ? m('th', 'Serah') : void 8)), m('tbody', attr.amprah.amprahList().map(function(i){
            var arr, ref$, that, this$ = this;
            return m('tr', tds(arr = [
              hari(i.tanggal_minta), function(it){
                return it.full;
              }(modules.find(function(it){
                return it.name === i.ruangan;
              })), _.startCase(function(it){
                return it.username;
              }(Meteor.users.findOne(i.peminta))), i.jumlah + " unit", (ref$ = look2('gudang', i.nama)) != null ? ref$.nama : void 8, (that = i.penyerah) ? _.startCase(function(it){
                return it.username;
              }(Meteor.users.findOne(that))) : void 8, (that = i.diserah) ? that + " unit" : void 8, (that = i.tanggal_serah) ? hari(that) : void 8, attr.amprah.buttonConds(i) ? m('.button.is-primary', {
                onclick: function(){
                  return state.modal = i;
                }
              }, m('span', 'Serah')) : void 8
            ]));
          }))), state.modal ? elem.modal({
            title: 'Respon Amprah',
            content: state.modal.nama
              ? m('div', m('table.table', m('thead', m('tr', ['diminta', 'sedia'].map(function(i){
                return m('th', _.startCase(i));
              }))), m('tbody', m('tr', tds(arr = [
                state.modal.jumlah, _.sum(look2('gudang', state.modal.nama).batch.map(function(i){
                  if (userGroup('farmasi')) {
                    return i.digudang;
                  } else {
                    return i.diapotik;
                  }
                }))
              ])))), m(autoForm({
                schema: new SimpleSchema(schema.responAmprah),
                id: 'formResponAmprah',
                type: 'method',
                meteormethod: 'serahAmprah',
                hooks: {
                  before: function(doc, cb){
                    return cb(_.merge(doc, state.modal));
                  },
                  after: function(doc){
                    state.modal = doc;
                    return m.redraw();
                  }
                }
              })))
              : m('table.table', m('thead', m('tr', ['nama_obat', 'no_batch', 'serahkan'].map(function(i){
                return m('th', _.startCase(i));
              }))), m('tbody', state.modal.map(function(i){
                return m('tr', tds(_.map(i, function(it){
                  return it;
                })));
              })))
          }) : void 8);
        }
      };
    }
  };
  m.route.prefix('');
  m.route(document.body, '/dashboard', _.merge.apply(_, [{
    '/dashboard': comp.layout(comp.welcome())
  }].concat(
    slice$.call(modules.map(function(arg$){
      var name, ref$;
      name = arg$.name;
      return ref$ = {}, ref$["/" + name] = comp.layout(typeof comp[name] == 'function' ? comp[name]() : void 8), ref$;
    })), [{
      '/regis/:jenis': comp.layout(comp.pasien()),
      '/regis/:jenis/:idpasien': comp.layout(comp.pasien()),
      '/jalan/:idpasien': comp.layout(comp.pasien()),
      '/manajemen/:subroute': comp.layout(comp.manajemen()),
      '/login': comp.layout(comp.login()),
      '/farmasi/:idbarang': comp.layout(comp.farmasi())
    }]
  )));
}
function in$(x, xs){
  var i = -1, l = xs.length >>> 0;
  while (++i < l) if (x === xs[i]) return true;
  return false;
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

},"server.ls.js":function(){

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//                                                                                                                     //
// server.ls.js                                                                                                        //
//                                                                                                                     //
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
                                                                                                                       //
// Generated by LiveScript 1.5.0
var backup, slice$ = [].slice;
if (Meteor.isServer) {
  backup = function(){
    return ['pasien', 'gudang', 'users', 'rekap', 'amprah'].map(function(i){
      return shell.exec("mongoexport -h localhost:3001 -d meteor -c " + i + " -o ~/backup/" + _.kebabCase(hari(new Date)) + "-" + i + ".json");
    });
  };
  Meteor.startup(function(){
    return new Meteor.Cron({
      events: {
        "0 0 * * *": backup
      }
    });
  });
  Meteor.publish('coll', function(name, sel, opt){
    sel == null && (sel = {});
    opt == null && (opt = {});
    return coll[name].find(sel, opt);
  });
  Meteor.publish('users', function(sel, opt){
    sel == null && (sel = {});
    opt == null && (opt = {});
    return Meteor.users.find(sel, opt);
  });
  Meteor.methods({
    newUser: function(doc){
      var that, i$, ref$, len$, i, results$ = [];
      if (that = Accounts.findUserByUsername(doc.username)) {
        for (i$ = 0, len$ = (ref$ = ['username', 'password']).length; i$ < len$; ++i$) {
          i = ref$[i$];
          results$.push(Accounts["set" + _.startCase(i)](that._id, doc[i]));
        }
        return results$;
      } else {
        return Accounts.createUser(doc);
      }
    },
    addRole: function(arg$){
      var id, roles, group, poli;
      id = arg$.id, roles = arg$.roles, group = arg$.group, poli = arg$.poli;
      return Roles.addUsersToRoles(id, poli || roles, group);
    },
    rmRole: function(id){
      return Meteor.users.update({
        _id: id
      }, {
        $set: {
          roles: {}
        }
      });
    },
    importRoles: function(doc){
      var that;
      if (that = Accounts.findUserByUsername(doc.username)) {
        return Roles.addUsersToRoles(that._id, doc.poli || doc.role, doc.group);
      }
    },
    'import': function(name, selector, modifier, arrName){
      var find, that, ref$;
      find = coll[name].find(selector);
      if (arrName) {
        if (that = find) {
          return coll[name].update({
            _id: find._id
          }, {
            $push: (ref$ = {}, ref$[that + ""] = modifier[that][0], ref$)
          });
        } else {
          return coll[name].insert(_.merge(selector, modifier));
        }
      } else {
        return coll[name].insert(_.merge(selector, modifier));
      }
    },
    rmRawat: function(idpasien, idrawat){
      return coll.pasien.update(idpasien, {
        $set: {
          rawat: coll.pasien.findOne(idpasien).rawat.filter(function(it){
            return it.idrawat !== idrawat;
          })
        }
      });
    },
    updateArrayElm: function(arg$){
      var name, recId, scope, elmId, doc, ref$;
      name = arg$.name, recId = arg$.recId, scope = arg$.scope, elmId = arg$.elmId, doc = arg$.doc;
      return coll[name].update(recId, {
        $set: (ref$ = {}, ref$[scope + ""] = coll[name].findOne(recId)[scope].map(function(i){
          if (i["id" + scope] === elmId) {
            return doc;
          } else {
            return i;
          }
        }), ref$)
      });
    },
    serahObat: function(arg$){
      var _id, obat, batches, pasien, i$, len$, i;
      _id = arg$._id, obat = arg$.obat;
      batches = [];
      pasien = coll.pasien.findOne(_id);
      for (i$ = 0, len$ = obat.length; i$ < len$; ++i$) {
        i = obat[i$];
        coll.gudang.update(i.nama, {
          $set: {
            batch: reduce([], coll.gudang.findOne(i.nama).batch, fn$)
          }
        });
      }
      return reduce([], batches, function(res, inc){
        var obj;
        obj = {
          nama_obat: inc.nama_obat,
          nobatch: inc.nobatch,
          jumlah: inc.jumlah
        };
        if (res.find(function(i){
          return i.idpasien === inc.idpasien;
        })) {
          return res.map(function(i){
            if (i.idpasien === inc.idpasien) {
              return {
                idpasien: i.idpasien,
                obat: slice$.call(i.obat).concat([obj])
              };
            }
          });
        } else {
          return slice$.call(res).concat([{
            idpasien: inc.idpasien,
            obat: [obj]
          }]);
        }
      }).map(function(i){
        return _.assign(i, {
          obat: reduce([], i.obat, function(res, inc){
            var obj;
            obj = {
              nobatch: inc.nobatch,
              jumlah: inc.jumlah
            };
            if (res.find(function(i){
              return i.nama_obat === inc.nama_obat;
            })) {
              return res.map(function(i){
                return _.assign(i, {
                  batches: slice$.call(i.batches).concat([obj])
                });
              });
            } else {
              return slice$.call(res).concat([{
                nama_obat: inc.nama_obat,
                batches: [obj]
              }]);
            }
          })
        });
      });
      function fn$(res, inc){
        var arr, minim, doc;
        return arr = slice$.call(res).concat([i.jumlah < 1
          ? inc
          : (minim = function(){
            return min([i.jumlah, inc.diapotik]);
          }, batches.push({
            idpasien: pasien._id,
            nama_obat: i.nama,
            nobatch: inc.nobatch,
            jumlah: minim()
          }), doc = _.assign({}, inc, {
            diapotik: inc.diapotik - minim()
          }), i.jumlah -= minim(), doc)]);
      }
    },
    serahAmprah: function(doc){
      var batches, stock;
      coll.amprah.update(doc._id, doc);
      batches = [];
      stock = doc.ruangan === 'obat' ? 'digudang' : 'diapotik';
      coll.gudang.update(doc.nama, {
        $set: {
          batch: reduce([], coll.gudang.findOne(doc.nama).batch, function(res, inc){
            var arr, minim, obj, ref$;
            return arr = slice$.call(res).concat([doc.diserah < 1 || inc[stock] < 1
              ? inc
              : (minim = function(){
                return min([doc.diserah, inc[stock]]);
              }, batches.push({
                nama_obat: coll.gudang.findOne(doc.nama).nama,
                no_batch: inc.nobatch,
                serah: minim()
              }), obj = _.assign({}, inc, (ref$ = {}, ref$[stock + ""] = inc[stock] - minim(), ref$), stock === 'digudang' ? {
                diapotik: inc['diapotik'] + minim()
              } : void 8), doc.diserah -= minim(), obj)]);
          })
        }
      });
      return batches;
    },
    doneRekap: function(){
      var sel, opt;
      sel = {
        printed: {
          $exists: false
        }
      };
      opt = {
        $set: {
          printed: new Date()
        }
      };
      return coll.rekap.update(sel, opt, {
        multi: true
      });
    },
    sortByDate: function(idbarang){
      return coll.gudang.update(idbarang, {
        $set: {
          batch: function(){
            var source, sortedIn, sortedEd;
            source = coll.gudang.findOne(idbarang).batch;
            sortedIn = _.sortBy(source, function(i){
              return new Date(i.masuk).getTime();
            });
            return sortedEd = _.sortBy(sortedIn, function(i){
              return new Date(i.kadaluarsa).getTime();
            });
          }()
        }
      });
    },
    icdX: function(arg$){
      var rawat, pasien, icdx;
      rawat = arg$.rawat, pasien = arg$.pasien, icdx = arg$.icdx;
      return coll.pasien.update(pasien._id, {
        $set: {
          rawat: coll.pasien.findOne(pasien._id).rawat.map(function(i){
            if (i.idrawat !== rawat.idrawat) {
              return i;
            } else {
              return _.merge(rawat, {
                icdx: icdx
              });
            }
          })
        }
      });
    },
    onePasien: function(it){
      return coll.pasien.findOne({
        no_mr: +it
      });
    },
    mergePatients: function(){
      var grouped, filtered, merged;
      grouped = _.groupBy(coll.pasien.find().fetch(), 'no_mr');
      filtered = _.filter(grouped, function(it){
        return it.length > 1;
      });
      merged = filtered.map(function(it){
        return _.merge.apply(_, it);
      });
      return merged.map(function(it){
        coll.pasien.remove({
          no_mr: it.no_mr
        });
        return coll.pasien.insert(it);
      });
    },
    incomes: function(start, end){
      if (start < end) {
        return _.compact(_.flattenDeep(coll.pasien.find().fetch().map(function(i){
          var ref$;
          return (ref$ = i.rawat) != null ? ref$.map(function(j){
            var conds, arr, ref$, card, this$ = this;
            conds = ands(arr = [start < (ref$ = j.tanggal) && ref$ < end, j.status_bayar || j.billRegis]);
            card = i.rawat.length > 1 ? 10000 : false;
            return {
              'NO. MR': i.no_mr,
              'NAMA PASIEN': i.regis.nama_lengkap,
              'TANGGAL': hari(j.tanggal),
              'JENIS PEMBAYARAN': function(it){
                return it.join(' + ');
              }(_.compact(arr = ['Regis', card ? 'Kartu' : void 8, j.tindakan ? 'Tindakan' : void 8])),
              'KLINIK': look('klinik', j.klinik).label,
              'NO.KARCIS': j.nobill,
              'JUMLAH (Rp)': _.sum(arr = [
                card, look('karcis', j.klinik).label * 1000, _.sum((ref$ = j.tindakan) != null ? ref$.map(function(k){
                  return look2('tarif', k.nama).harga;
                }) : void 8)
              ])
            };
          }) : void 8;
        })));
      }
    },
    dispenses: function(start, end){
      var getPrice, a, b, c, d;
      if (start < end) {
        getPrice = function(nama_obat, no_batch){
          return coll.gudang.findOne(nama_obat).batch.find(function(it){
            return it.nobatch === no_batch;
          }).beli;
        };
        a = coll.rekap.find().fetch().filter(function(it){
          var ref$;
          return start < (ref$ = it.printed) && ref$ < end;
        });
        b = _.flattenDeep(a.map(function(i){
          return i.obat.map(function(j){
            return j.batches.map(function(k){
              return {
                nama_obat: j.nama_obat,
                no_batch: k.nobatch,
                jumlah: k.jumlah
              };
            });
          });
        }));
        c = reduce([], b, function(res, inc){
          var matched;
          matched = function(it){
            var arr;
            return _.every(arr = [it.nama_obat === inc.nama_obat, it.no_batch === inc.no_batch]);
          };
          if (!res.find(function(it){
            return matched(it);
          })) {
            return slice$.call(res).concat([inc]);
          } else {
            return res.map(function(it){
              if (!matched(it)) {
                return it;
              } else {
                return _.assign(it, {
                  jumlah: it.jumlah + inc.jumlah
                });
              }
            });
          }
        });
        return d = c.map(function(i){
          var price, obj, awal;
          price = getPrice(i.nama_obat, i.no_batch);
          obj = coll.gudang.findOne(i.nama_obat);
          awal = _.sum(obj.batch.map(function(it){
            if (it.nobatch === i.no_batch) {
              return it.awal;
            }
          }));
          return {
            'Nama Obat': obj.nama,
            'No. Batch': i.no_batch,
            'Jumlah': i.jumlah,
            'Harga': price,
            'Total': price * i.jumlah,
            'Stok Awal': awal,
            'Stok Akhir': awal - i.jumlah
          };
        });
      }
    },
    visits: function(start, end){
      var docs, pipe, a, list, b, c, x, maped, grouped, result;
      docs = coll.pasien.aggregate(pipe = [
        a = {
          $match: {
            rawat: {
              $elemMatch: {
                $and: list = [
                  {
                    tanggal: {
                      $gt: start
                    }
                  }, {
                    tanggal: {
                      $lt: end
                    }
                  }
                ]
              }
            }
          }
        }, b = {
          $unwind: '$rawat'
        }, c = {
          $match: {
            $and: x = [
              {
                'rawat.tanggal': {
                  $gt: start
                }
              }, {
                'rawat.tanggal': {
                  $lt: end
                }
              }
            ]
          }
        }
      ]);
      maped = docs.map(function(i){
        return _.merge.apply(_, [
          {}, {
            hari: moment(i.rawat.tanggal).format('D MMM YYYY')
          }
        ].concat(slice$.call(['tanggal', 'klinik', 'cara_bayar'].map(function(j){
          var ref$;
          return ref$ = {}, ref$[j + ""] = i.rawat[j], ref$;
        }))));
      });
      grouped = _.groupBy(maped, 'hari');
      result = _.map(grouped, function(val, key){
        var this$ = this;
        return {
          hari: key,
          tanggal: new Date(key),
          poli: _.merge.apply(_, selects.klinik.map(function(v, k){
            var ref$, this$ = this;
            return ref$ = {}, ref$[v.label + ""] = function(it){
              return it.length;
            }(val.filter(function(it){
              return it.klinik === k + 1;
            })), ref$;
          })),
          bayar: _.merge.apply(_, selects.cara_bayar.map(function(v, k){
            var ref$, this$ = this;
            return ref$ = {}, ref$[v.label + ""] = function(it){
              return it.length;
            }(val.filter(function(it){
              return it.cara_bayar === k + 1;
            })), ref$;
          })),
          status: _.merge({
            Baru: function(it){
              return it.length;
            }(val.filter(function(it){
              return it.baru;
            }))
          }, {
            Lama: val.length - function(it){
              return it.length;
            }(val.filter(function(it){
              return it.baru;
            }))
          })
        };
      });
      return _.sortBy(result, 'tanggal');
    },
    stocks: function(start, end){
      var pipe, a, arr, b, c;
      return coll.gudang.aggregate(pipe = [
        a = {
          $match: {
            batch: {
              $elemMatch: {
                $and: arr = [
                  {
                    masuk: {
                      $gt: start
                    }
                  }, {
                    masuk: {
                      $lt: end
                    }
                  }
                ]
              }
            }
          }
        }, b = {
          $unwind: '$batch'
        }, c = {
          $match: {
            $and: arr = [
              {
                'batch.masuk': {
                  $gt: start
                }
              }, {
                'batch.masuk': {
                  $lt: end
                }
              }
            ]
          }
        }
      ]).map(function(i){
        return {
          'Nama Obat': i.nama,
          'Kemasan': look('satuan', i.satuan).label,
          'Satuan': look('satuan', i.satuan).label,
          'Jenis': look('barang', i.jenis).label,
          'Batch': i.batch.nobatch,
          'ED': hari(i.batch.kadaluarsa),
          'Harga Satuan': rupiah(i.batch.beli),
          'Stok Awal': i.batch.awal.toString(),
          'Sisa Stock': i.batch.digudang.toString(),
          'Total Nilai': rupiah(i.batch.digudang * i.batch.beli)
        };
      });
    },
    notify: function(name){
      var obj;
      obj = {
        amprah: function(){
          return coll.amprah.find({
            diserah: {
              $exists: false
            }
          }).fetch().length;
        }
      };
      return typeof obj[name] == 'function' ? obj[name]() : void 8;
    },
    nextMR: function(){
      var list, pipe, nums, index;
      list = coll.pasien.aggregate(pipe = [
        {
          $project: {
            no_mr: 1
          }
        }, {
          $sort: {
            no_mr: 1
          }
        }
      ]);
      nums = list.map(function(it){
        return it.no_mr;
      });
      index = nums.findIndex(function(i, j, k){
        return i - k[j - 1] > 1;
      });
      return nums[index - 1] + 1;
    },
    backupNow: backup
  });
}
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}},{
  "extensions": [
    ".js",
    ".json",
    ".html",
    ".css"
  ]
});

require("/folder/funcs.ls.js");
require("/folder/modules.ls.js");
require("/folder/parent.ls.js");
require("/folder/pdf.ls.js");
require("/folder/rights.ls.js");
require("/folder/selects.ls.js");
require("/both.ls.js");
require("/client.ls.js");
require("/server.ls.js");